var e=Object.defineProperty,s=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,n,a)=>n in s?e(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a,r=(e,s)=>{for(var n in s||(s={}))t.call(s,n)&&i(e,n,s[n]);if(a)for(var n of a(s))l.call(s,n)&&i(e,n,s[n]);return e},c=(e,a)=>s(e,n(a)),d=(e,s,n)=>new Promise((a,t)=>{var l=e=>{try{r(n.next(e))}catch(s){t(s)}},i=e=>{try{r(n.throw(e))}catch(s){t(s)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);r((n=n.apply(e,s)).next())});import{j as o,S as m,e as u,a as g,X as h,ae as x,af as p,ad as j,d as b,i as f,aa as v,t as y}from"./ui-vendor-NJW5rtDU.js";import{M as N}from"./MediaUpload-DSeSwC9g.js";import{r as w,u as A}from"./react-vendor-7nhe2WMs.js";import{u as M,X as C,I as k,B as I,D as S,q as _,r as F,s as B,t as U,L as O,T as E,H as P,E as L,a8 as D,a9 as T,aa as z,Q as q,d as R,Z as $,w as K,x as G,y as W,z as H,A as J,G as Q,J as V,K as X,N as Z,ab as Y,ac as ee,ad as se,ae as ne}from"./index-DR4W6oDl.js";import{T as ae,a as te,b as le,c as ie,d as re,e as ce}from"./table-BjDYCMyB.js";import{C as de}from"./checkbox-CkNnxXkh.js";const oe=({onAddressSelect:e,initialAddress:s="",initialCoordinates:n,onClose:a})=>{const{t:t}=M("components",{keyPrefix:"AddressMapSelector"}),l=w.useRef(null),[i,r]=w.useState(null),[c,d]=w.useState(null),[h,x]=w.useState(s),[p,j]=w.useState(s),[b,f]=w.useState(n||{lat:31.7683,lng:35.2137}),[v,y]=w.useState(null),[N,A]=w.useState(!1);w.useEffect(()=>{const e="AIzaSyAjx6NIRePitcFdZjH2kE0z-zSAy8etaUE";let s=!0,n=null;return(()=>{const a=document.querySelectorAll('script[src*="maps.googleapis.com"]');let t=!1;if(a.forEach(e=>{e.src.includes("AIzaSyAwzQsbG0vO0JWzOs7UAyu0upW6Xc1KL4E")&&(e.remove(),t=!0)}),t&&(delete window.google,delete window.initMap),window.google&&window.google.maps)return void(s&&S());const l=document.querySelector('script[src*="maps.googleapis.com"]');if(l&&l.src.includes(e))window.google&&window.google.maps?s&&S():(n=setInterval(()=>{window.google&&window.google.maps&&s&&(n&&(clearInterval(n),n=null),S())},100),setTimeout(()=>{n&&(clearInterval(n),n=null)},5e3));else if(l&&!l.src.includes(e)&&(l.remove(),delete window.google,delete window.initMap),!document.querySelector('script[src*="maps.googleapis.com"]')){const s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=places,marker&callback=initMap`,s.async=!0,s.defer=!0,window.initMap=S,document.head.appendChild(s)}})(),()=>{if(s=!1,n&&(clearInterval(n),n=null),window.initMap===S)try{delete window.initMap}catch(e){}}},[]);const S=()=>{if(!l.current||!window.google)return;const e=new window.google.maps.Map(l.current,{center:b,zoom:15,mapId:"DEMO_MAP_ID",mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,gestureHandling:"greedy"}),n=new window.google.maps.Geocoder;y(n);const a=new window.google.maps.marker.AdvancedMarkerElement({position:b,map:e,gmpDraggable:!0,title:t("markerTitle")});r(e),d(a),e.addListener("click",e=>{const s={lat:e.latLng.lat(),lng:e.latLng.lng()};a.position=s,f(s),_(s,n)}),a.addListener("dragend",e=>{const s={lat:e.latLng.lat(),lng:e.latLng.lng()};f(s),_(s,n)}),s&&F(s,n,e,a)},_=(e,s)=>{s.geocode({location:e},(e,s)=>{"OK"===s&&e[0]&&(j(e[0].formatted_address),x(e[0].formatted_address))})},F=(e,s,n,a)=>{A(!0),s.geocode({address:e},(e,s)=>{if(A(!1),"OK"===s&&e[0]){const s=e[0].geometry.location,t={lat:s.lat(),lng:s.lng()};n.setCenter(t),a.position=t,f(t),j(e[0].formatted_address),x(e[0].formatted_address)}else C.error(t("errors.geocodeFailed"))})},B=()=>{h.trim()&&v&&i&&c&&F(h,v,i,c)};return o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx("div",{className:"p-4 border-b",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("div",{className:"relative flex-1",children:[o.jsx(m,{className:"absolute ltr:left-3 rtl:right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),o.jsx(k,{value:h,onChange:e=>x(e.target.value),onKeyPress:e=>{"Enter"===e.key&&B()},placeholder:t("searchPlaceholder"),className:"ltr:pl-10 rtl:pr-10",disabled:N})]}),o.jsx(I,{onClick:B,disabled:N||!h.trim(),variant:"outline",children:N?o.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):o.jsx(m,{className:"w-4 h-4"})})]})}),o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("div",{ref:l,className:"w-full h-full"}),o.jsx("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur-sm rounded-lg p-3 shadow-lg max-w-xs",children:o.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[o.jsx(u,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{children:t("instructions")})]})})]}),o.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[o.jsxs("div",{className:"mb-3",children:[o.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-1",children:t("selectedAddress")}),o.jsx("div",{className:"text-sm text-gray-600 bg-white p-2 rounded border",children:p||t("noAddressSelected")})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(I,{onClick:()=>{p&&b&&(e(p,b),a&&a())},disabled:!p,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[o.jsx(g,{className:"w-4 h-4 mr-2"}),t("confirmAddress")]}),a&&o.jsx(I,{onClick:a,variant:"outline",className:"px-6",children:t("cancel")})]})]})]})};function me(){const{t:e}=M(),[s,n]=w.useState(!1),[a,t]=w.useState(!1),[l,i]=w.useState({name:"",description:"",imageUrl:"",contactInfo:{email:"",phone:""},location:{lat:null,lng:null,displayName:""},tags:[],rating:""}),[m,g]=w.useState(!1),[h,x]=w.useState(null);A();const p=e=>{const{name:s,value:n}=e.target;if(s.startsWith("contactInfo.")){const e=s.split(".")[1];i(s=>c(r({},s),{contactInfo:c(r({},s.contactInfo),{[e]:n})}))}else i(e=>c(r({},e),{[s]:n}))};return o.jsxs(S,{open:s,onOpenChange:n,children:[o.jsx(_,{asChild:!0,children:o.jsx(I,{children:e("Admin.businessManagement.addNewBusiness")})}),o.jsxs(F,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[o.jsx(B,{children:o.jsx(U,{children:e("Admin.businessManagement.addNewBusiness")})}),h&&o.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:h}),o.jsxs("form",{onSubmit:s=>d(null,null,function*(){if(s.preventDefault(),g(!0),x(null),!l.location.lat||!l.location.lng)return x(e("Admin.businessManagement.locationRequired")||"Please select a location on the map"),void g(!1);const{lat:a,lng:t}=l.location;if(a<29.5||a>33.3||t<34.2||t>35.9)return x(e("Admin.businessManagement.locationMustBeInIsrael")||"Location must be within Israel"),void g(!1);try{const e=yield D({name:l.name,description:l.description,imageUrl:l.imageUrl&&""!==l.imageUrl.trim()?l.imageUrl:"",contactInfo:{email:l.contactInfo.email,phone:l.contactInfo.phone},location:{lat:l.location.lat,lng:l.location.lng,displayName:l.location.displayName},tags:l.tags,rating:l.rating?Number(l.rating):void 0});if(!e.success)throw new Error(e.error||"Failed to create business");i({name:"",description:"",imageUrl:"",contactInfo:{email:"",phone:""},location:{lat:null,lng:null,displayName:""},tags:[],rating:""}),n(!1),window.location.reload()}catch(r){x(r.message||"Failed to create business. Please try again.")}finally{g(!1)}}),className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"name",children:e("Admin.businessManagement.name")}),o.jsx(k,{id:"name",name:"name",value:l.name,onChange:p,placeholder:e("Admin.businessManagement.namePlaceholder"),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"description",children:e("Admin.businessManagement.description")}),o.jsx(E,{id:"description",name:"description",value:l.description,onChange:p,placeholder:e("Admin.businessManagement.descriptionPlaceholder"),rows:3,required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"imageUrl",children:e("Admin.businessManagement.image")}),o.jsx(N,{type:"image",value:l.imageUrl,onChange:e=>{i(s=>c(r({},s),{imageUrl:e}))}})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{children:e("Admin.businessManagement.tags")}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border rounded-md p-2",children:P.map(e=>o.jsx("button",{type:"button",onClick:()=>(e=>{i(s=>s.tags.includes(e)?c(r({},s),{tags:s.tags.filter(s=>s!==e)}):c(r({},s),{tags:[...s.tags,e]}))})(e),className:`\n                    text-left p-2 rounded text-sm transition-colors\n                    ${l.tags.includes(e)?"bg-primary text-primary-foreground":"bg-gray-100 hover:bg-gray-200"}\n                  `,children:e},e))}),l.tags.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:e("Admin.businessManagement.selectedTags",{count:l.tags.length})}),o.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags.map(e=>o.jsx("span",{className:"bg-primary text-primary-foreground px-2 py-1 rounded text-sm",children:e},e))})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"rating",children:e("Admin.businessManagement.rating")}),o.jsx(k,{id:"rating",name:"rating",type:"number",min:"1",max:"5",step:"0.1",value:l.rating,onChange:p,placeholder:e("Admin.businessManagement.ratingPlaceholder")})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(O,{children:e("Admin.businessManagement.contactInfo")}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"email",children:e("Admin.businessManagement.email")}),o.jsx(k,{id:"email",name:"contactInfo.email",type:"email",value:l.contactInfo.email,onChange:p,placeholder:e("Admin.businessManagement.emailPlaceholder"),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"phone",children:e("Admin.businessManagement.phone")}),o.jsx(k,{id:"phone",name:"contactInfo.phone",value:l.contactInfo.phone,onChange:p,placeholder:e("Admin.businessManagement.phonePlaceholder"),required:!0})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(O,{children:[e("Admin.businessManagement.location")||"Location"," *"]}),l.location.lat&&l.location.lng?o.jsx("div",{className:"border rounded-lg p-3 bg-green-50 border-green-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(u,{className:"w-4 h-4 text-green-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-green-800",children:l.location.displayName||e("Admin.businessManagement.locationSelected")}),o.jsxs("p",{className:"text-xs text-green-600",children:[l.location.lat.toFixed(5),", ",l.location.lng.toFixed(5)]})]})]}),o.jsx(I,{type:"button",variant:"outline",size:"sm",onClick:()=>t(!0),children:e("Admin.businessManagement.changeLocation")||"Change"})]})}):o.jsx(I,{type:"button",variant:"outline",className:"w-full h-20 border-dashed",onClick:()=>t(!0),children:o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx(u,{className:"w-6 h-6 text-gray-400"}),o.jsx("span",{className:"text-sm text-gray-500",children:e("Admin.businessManagement.selectLocation")||"Click to select location on map"})]})})]}),o.jsxs(L,{children:[o.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),children:e("Admin.common.cancel")}),o.jsx(I,{type:"submit",disabled:m,children:e(m?"Admin.businessManagement.creating":"Admin.businessManagement.createBusiness")})]})]})]}),o.jsx(S,{open:a,onOpenChange:t,children:o.jsxs(F,{className:"sm:max-w-[800px] h-[80vh] p-0",children:[o.jsx(B,{className:"p-4 pb-0",children:o.jsx(U,{children:e("Admin.businessManagement.selectLocationOnMap")||"Select Location on Map"})}),o.jsx("div",{className:"flex-1 h-[calc(80vh-80px)]",children:o.jsx(oe,{onAddressSelect:(e,s)=>{const n=e.split(","),a=n.length>=2?n[n.length-2].trim():n[0].trim();i(e=>c(r({},e),{location:{lat:s.lat,lng:s.lng,displayName:a}})),t(!1)},initialAddress:l.location.displayName,initialCoordinates:l.location.lat&&l.location.lng?{lat:l.location.lat,lng:l.location.lng}:void 0,onClose:()=>t(!1)})})]})})]})}function ue({business:e,isOpen:s,onClose:n,onSuccess:a}){const{t:t}=M(),[l,i]=w.useState({name:"",description:"",imageUrl:"",contactInfo:{email:"",phone:""},location:{lat:null,lng:null,displayName:""},tags:[],filterIds:[],rating:""}),[m,g]=w.useState([]),[h,x]=w.useState(!1),[p,j]=w.useState(null),[b,f]=w.useState(!1),[v,y]=w.useState(!1);w.useEffect(()=>{var n,a,t,l,r,c,d,o,m;s&&(A(),e&&i({name:e.name||"",description:e.description||"",imageUrl:e.imageUrl||"",contactInfo:{email:(null==(n=e.contactInfo)?void 0:n.email)||"",phone:(null==(a=e.contactInfo)?void 0:a.phone)||""},location:{lat:null!=(l=null==(t=e.location)?void 0:t.lat)?l:null,lng:null!=(c=null==(r=e.location)?void 0:r.lng)?c:null,displayName:(null==(d=e.location)?void 0:d.displayName)||(null==(o=e.contactInfo)?void 0:o.address)||""},tags:e.tags||[],filterIds:e.filterIds||[],rating:(null==(m=e.rating)?void 0:m.toString())||""}))},[s,e]);const A=()=>d(null,null,function*(){f(!0);try{const e=yield T();e.success&&e.filters&&g(e.filters)}catch(e){}finally{f(!1)}}),C=e=>{const{name:s,value:n}=e.target;if(s.startsWith("contactInfo.")){const e=s.split(".")[1];i(s=>c(r({},s),{contactInfo:c(r({},s.contactInfo),{[e]:n})}))}else i(e=>c(r({},e),{[s]:n}))};return o.jsxs(S,{open:s,onOpenChange:n,children:[o.jsxs(F,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[o.jsx(B,{className:"text-center pr-8",children:o.jsx(U,{className:"text-center",children:t("Admin.dialogs.editBusiness.title")})}),p&&o.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:p}),o.jsxs("form",{onSubmit:s=>d(null,null,function*(){if(s.preventDefault(),x(!0),j(null),l.location.lat&&l.location.lng){const{lat:e,lng:s}=l.location;if(e<29.5||e>33.3||s<34.2||s>35.9)return j(t("Admin.businessManagement.locationMustBeInIsrael")||"Location must be within Israel"),void x(!1)}try{const s=yield z(e.id,{name:l.name,description:l.description,imageUrl:l.imageUrl,contactInfo:{email:l.contactInfo.email,phone:l.contactInfo.phone},location:l.location.lat&&l.location.lng?{lat:l.location.lat,lng:l.location.lng,displayName:l.location.displayName}:void 0,tags:l.tags,filterIds:l.filterIds&&l.filterIds.length>0?l.filterIds:void 0,rating:l.rating?Number(l.rating):void 0});if(!s.success)throw new Error(s.error||"Failed to update business");a(),n()}catch(i){j(i.message||"Failed to update business. Please try again.")}finally{x(!1)}}),className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"name",children:t("Admin.businessManagement.name")}),o.jsx(k,{id:"name",name:"name",value:l.name,onChange:C,placeholder:t("Admin.dialogs.editBusiness.enterBusinessName"),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"description",children:t("Admin.businessManagement.description")}),o.jsx(E,{id:"description",name:"description",value:l.description,onChange:C,placeholder:t("Admin.dialogs.editBusiness.enterBusinessDescription"),rows:3,required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"imageUrl",children:t("Admin.businessManagement.image")}),o.jsx(N,{type:"image",value:l.imageUrl,onChange:e=>{i(s=>c(r({},s),{imageUrl:e}))}})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{children:t("Admin.dialogs.editBusiness.tags")}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border rounded-md p-2",children:P.map(e=>o.jsx("button",{type:"button",onClick:()=>(e=>{i(s=>s.tags.includes(e)?c(r({},s),{tags:s.tags.filter(s=>s!==e)}):c(r({},s),{tags:[...s.tags,e]}))})(e),className:`\n                    text-left p-2 rounded text-sm transition-colors\n                    ${l.tags.includes(e)?"bg-primary text-primary-foreground":"bg-gray-100 hover:bg-gray-200"}\n                  `,children:e},e))}),l.tags.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-xs text-gray-600 mb-1",children:t("Admin.dialogs.editBusiness.selectedTags",{count:l.tags.length})}),o.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags.map(e=>o.jsx("span",{className:"bg-primary text-primary-foreground px-2 py-1 rounded text-sm",children:e},e))})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"rating",children:t("Admin.businessManagement.rating")}),o.jsx(k,{id:"rating",name:"rating",type:"number",min:"1",max:"5",step:"0.1",value:l.rating,onChange:C,placeholder:t("Admin.dialogs.editBusiness.enterRating")})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(O,{children:t("Admin.dialogs.editBusiness.contactInformation")}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"email",children:t("Admin.dialogs.editBusiness.email")}),o.jsx(k,{id:"email",name:"contactInfo.email",type:"email",value:l.contactInfo.email,onChange:C,placeholder:t("Admin.dialogs.editBusiness.emailPlaceholder"),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{htmlFor:"phone",children:t("Admin.dialogs.editBusiness.phone")}),o.jsx(k,{id:"phone",name:"contactInfo.phone",value:l.contactInfo.phone,onChange:C,placeholder:t("Admin.dialogs.editBusiness.phonePlaceholder"),required:!0})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{children:t("Admin.businessManagement.location")||"Location"}),l.location.lat&&l.location.lng?o.jsx("div",{className:"border rounded-lg p-3 bg-green-50 border-green-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(u,{className:"w-4 h-4 text-green-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-green-800",children:l.location.displayName||t("Admin.businessManagement.locationSelected")}),o.jsxs("p",{className:"text-xs text-green-600",children:[l.location.lat.toFixed(5),", ",l.location.lng.toFixed(5)]})]})]}),o.jsx(I,{type:"button",variant:"outline",size:"sm",onClick:()=>y(!0),children:t("Admin.businessManagement.changeLocation")||"Change"})]})}):o.jsx(I,{type:"button",variant:"outline",className:"w-full h-20 border-dashed",onClick:()=>y(!0),children:o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx(u,{className:"w-6 h-6 text-gray-400"}),o.jsx("span",{className:"text-sm text-gray-500",children:t("Admin.businessManagement.selectLocation")||"Click to select location on map"})]})})]}),o.jsxs(L,{children:[o.jsx(I,{type:"button",variant:"outline",onClick:n,children:t("Admin.dialogs.editBusiness.cancel")}),o.jsx(I,{type:"submit",disabled:h,children:t(h?"Admin.dialogs.editBusiness.updating":"Admin.dialogs.editBusiness.update")})]})]})]}),o.jsx(S,{open:v,onOpenChange:y,children:o.jsxs(F,{className:"sm:max-w-[800px] h-[80vh] p-0",children:[o.jsx(B,{className:"p-4 pb-0",children:o.jsx(U,{children:t("Admin.businessManagement.selectLocationOnMap")||"Select Location on Map"})}),o.jsx("div",{className:"flex-1 h-[calc(80vh-80px)]",children:o.jsx(oe,{onAddressSelect:(e,s)=>{const n=e.split(","),a=n.length>=2?n[n.length-2].trim():n[0].trim();i(e=>c(r({},e),{location:{lat:s.lat,lng:s.lng,displayName:a}})),y(!1)},initialAddress:l.location.displayName,initialCoordinates:l.location.lat&&l.location.lng?{lat:l.location.lat,lng:l.location.lng}:void 0,onClose:()=>y(!1)})})]})})]})}function ge({isOpen:e,onClose:s,selectedCount:n,onApply:a}){const{t:t}=M("Admin"),[l,i]=w.useState([]),[r,c]=w.useState([]),[m,u]=w.useState(!1),g=()=>{i([]),c([]),s()};return o.jsx(S,{open:e,onOpenChange:g,children:o.jsxs(F,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[o.jsxs(B,{className:"text-center pr-8",children:[o.jsx(U,{className:"text-center",children:t("businessManagement.bulkEditTitle",{count:n})}),o.jsx(q,{className:"text-center",children:t("businessManagement.bulkEditDescription")})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{children:t("businessManagement.addTags")}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border rounded-md p-2",children:P.map(e=>o.jsx("button",{type:"button",onClick:()=>(e=>{l.includes(e)?i(s=>s.filter(s=>s!==e)):r.includes(e)?c(s=>s.filter(s=>s!==e)):i(s=>[...s,e])})(e),className:`\n                    text-left p-2 rounded text-sm transition-colors\n                    ${l.includes(e)?"bg-green-500 text-white":r.includes(e)?"bg-red-100 text-red-700 line-through":"bg-gray-100 hover:bg-gray-200"}\n                  `,children:e},e))}),l.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[t("businessManagement.selectedToAdd",{count:l.length})," (",l.length,")"]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(e=>o.jsxs(R,{className:"bg-green-500 text-white",children:[e,o.jsx("button",{onClick:()=>i(s=>s.filter(s=>s!==e)),className:"ml-1 hover:bg-green-600 rounded-full p-0.5",children:o.jsx(h,{className:"h-3 w-3"})})]},e))})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(O,{children:t("businessManagement.removeTags")}),o.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border rounded-md p-2",children:P.map(e=>o.jsx("button",{type:"button",onClick:()=>(e=>{r.includes(e)?c(s=>s.filter(s=>s!==e)):l.includes(e)?i(s=>s.filter(s=>s!==e)):c(s=>[...s,e])})(e),className:`\n                    text-left p-2 rounded text-sm transition-colors\n                    ${r.includes(e)?"bg-red-500 text-white":l.includes(e)?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"}\n                  `,children:e},e))}),r.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[t("businessManagement.selectedToRemove",{count:r.length})," (",r.length,")"]}),o.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(e=>o.jsxs(R,{className:"bg-red-500 text-white",children:[e,o.jsx("button",{onClick:()=>c(s=>s.filter(s=>s!==e)),className:"ml-1 hover:bg-red-600 rounded-full p-0.5",children:o.jsx(h,{className:"h-3 w-3"})})]},e))})]})]})]}),o.jsxs(L,{children:[o.jsx(I,{type:"button",variant:"outline",onClick:g,children:t("common.cancel")}),o.jsx(I,{type:"button",onClick:()=>d(null,null,function*(){u(!0);try{yield a(l,r),i([]),c([]),s()}catch(e){}finally{u(!1)}}),disabled:m||0===l.length&&0===r.length,children:t(m?"businessManagement.applying":"businessManagement.applyChanges")})]})]})})}function he(){const{t:e}=M(),[s,n]=w.useState([]),[a,t]=w.useState([]),[l,i]=w.useState(!0),[m,g]=w.useState(null),[N,A]=w.useState(null),[C,k]=w.useState(!1),[S,_]=w.useState("__all__"),[F,B]=w.useState([]),[U,O]=w.useState(!1);w.useEffect(()=>{E()},[]);const E=()=>d(null,null,function*(){try{i(!0);const[e,s]=yield Promise.all([$(),T()]);e.success?n(e.businesses):g(e.error||"Failed to fetch businesses"),s.success&&t(s.filters)}catch(e){g("Failed to fetch data")}finally{i(!1)}}),P=e=>{B(e?D.map(e=>e.id):[])},L=w.useMemo(()=>"__all__"===S?null:a.find(e=>e.id===S),[a,S]),D=w.useMemo(()=>L?s.filter(e=>(e.filterIds||[]).includes(L.id)):s,[s,L]);return l?o.jsx("div",{className:"flex items-center justify-center p-8",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:e("common.loading")})]})}):m?o.jsx("div",{className:"p-4 rounded border border-red-400 bg-red-100 text-red-700",children:m}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between p-4 bg-gray-50 rounded-lg border",children:[o.jsxs("div",{className:"flex items-center gap-3 flex-1 w-full sm:w-auto",children:[o.jsx(x,{className:"h-5 w-5 text-gray-500 shrink-0"}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsxs(K,{value:S,onValueChange:_,children:[o.jsx(G,{className:"w-full",children:o.jsx(W,{placeholder:e("Admin.businessManagement.selectFilter")||"Select a filter..."})}),o.jsxs(H,{children:[o.jsx(J,{value:"__all__",children:e("Admin.businessManagement.allBusinesses")||"All Businesses"}),a.filter(e=>e.isActive).map(e=>o.jsx(J,{value:e.id,children:e.name},e.id))]})]})})]}),S&&"__all__"!==S&&o.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>_("__all__"),className:"shrink-0",children:[o.jsx(h,{className:"h-4 w-4 me-2"}),e("Admin.businessManagement.clearFilter")||"Clear filter"]})]}),F.length>0&&o.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(de,{checked:F.length===D.length,onCheckedChange:P}),o.jsx("span",{className:"font-medium text-blue-900",children:e("Admin.businessManagement.selectedCount",{count:F.length})})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(I,{variant:"outline",size:"sm",onClick:()=>O(!0),className:"gap-2",children:[o.jsx(p,{className:"h-4 w-4"}),e("Admin.businessManagement.bulkAssignTags")]}),o.jsx(I,{variant:"outline",size:"sm",onClick:()=>d(null,null,function*(){if(0!==F.length)try{const a=s.filter(e=>F.includes(e.id)),t=!a.every(e=>e.isActive),l=yield se(F,{isActive:t});l.success?(n(e=>e.map(e=>F.includes(e.id)?c(r({},e),{isActive:t}):e)),B([]),alert(e("Admin.businessManagement.bulkUpdateSuccess",{count:F.length}))):g(l.error||e("Admin.businessManagement.bulkUpdateError"))}catch(a){g(e("Admin.businessManagement.bulkUpdateError"))}}),className:"gap-2",children:e("Admin.businessManagement.bulkToggleStatus")}),o.jsxs(I,{variant:"destructive",size:"sm",onClick:()=>d(null,null,function*(){if(0===F.length)return;const s=e("Admin.businessManagement.confirmBulkDelete",{count:F.length});if(confirm(s))try{const s=yield ee(F);s.success?(n(e=>e.filter(e=>!F.includes(e.id))),B([]),alert(e("Admin.businessManagement.bulkDeleteSuccess",{count:F.length}))):g(s.error||e("Admin.businessManagement.bulkDeleteError"))}catch(a){g(e("Admin.businessManagement.bulkDeleteError"))}}),className:"gap-2",children:[o.jsx(j,{className:"h-4 w-4"}),e("Admin.businessManagement.bulkDelete")]})]})]}),S&&"__all__"!==S&&L&&o.jsxs("div",{className:"text-sm text-gray-600",children:[e("Admin.businessManagement.showingResults")||"Showing"," ",D.length," ",e("Admin.businessManagement.of")||"of"," ",s.length," ",e("Admin.businessManagement.businesses")||"businesses"]}),o.jsx("div",{className:"rounded-md border",children:o.jsxs(ae,{children:[o.jsx(te,{children:o.jsxs(le,{children:[o.jsx(ie,{className:"w-[50px]",children:o.jsx(de,{checked:F.length>0&&F.length===D.length,onCheckedChange:P})}),o.jsx(ie,{children:e("Admin.businessManagement.name")}),o.jsx(ie,{children:e("Admin.businessManagement.description")}),o.jsx(ie,{children:e("Admin.businessManagement.image")}),o.jsx(ie,{children:e("Admin.businessManagement.contactInfo")}),o.jsx(ie,{children:e("Admin.businessManagement.status")}),o.jsx(ie,{children:e("Admin.businessManagement.createdAt")}),o.jsx(ie,{className:"w-[50px]"})]})}),o.jsx(re,{children:0===D.length?o.jsx(le,{children:o.jsx(ce,{colSpan:8,className:"text-center py-8 text-gray-500",children:S&&"__all__"!==S?e("Admin.businessManagement.noBusinessesMatchingFilter")||"No businesses match the selected filter":e("Admin.businessManagement.noBusinesses")})}):D.map(s=>{return o.jsxs(le,{className:F.includes(s.id)?"bg-blue-50":"",children:[o.jsx(ce,{children:o.jsx(de,{checked:F.includes(s.id),onCheckedChange:e=>((e,s)=>{B(s?s=>[...s,e]:s=>s.filter(s=>s!==e))})(s.id,e)})}),o.jsx(ce,{className:"font-medium",children:s.name}),o.jsx(ce,{className:"max-w-xs truncate",children:s.description}),o.jsx(ce,{children:s.imageUrl?o.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden",children:o.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover"})}):o.jsx("div",{className:"w-10 h-10 rounded-md bg-gray-100 flex items-center justify-center",children:o.jsx("img",{className:"h-5 w-5 text-gray-400"})})}),o.jsx(ce,{children:o.jsxs("div",{className:"space-y-1 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(b,{className:"h-3 w-3 text-gray-400"}),o.jsx("span",{className:"truncate max-w-[150px]",children:s.contactInfo.email})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(f,{className:"h-3 w-3 text-gray-400"}),o.jsx("span",{children:s.contactInfo.phone})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(u,{className:"h-3 w-3 text-gray-400"}),o.jsx("span",{className:"truncate max-w-[150px]",children:s.contactInfo.address})]})]})}),o.jsx(ce,{children:o.jsx(R,{variant:s.isActive?"default":"secondary",children:s.isActive?e("Admin.status.active"):e("Admin.status.inactive")})}),o.jsx(ce,{className:"text-sm text-gray-500",children:(a=s.createdAt,new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(a))}),o.jsx(ce,{children:o.jsxs(Q,{children:[o.jsx(V,{asChild:!0,children:o.jsx(I,{variant:"ghost",className:"h-8 w-8 p-0",children:o.jsx(v,{className:"h-4 w-4"})})}),o.jsxs(X,{align:"end",children:[o.jsxs(Z,{onClick:()=>(e=>{A(e),k(!0)})(s),children:[o.jsx(y,{className:"me-2 h-4 w-4"}),e("Admin.businessManagement.edit")]}),o.jsx(Z,{onClick:()=>(e=>d(null,null,function*(){try{const s=yield z(e.id,{isActive:!e.isActive});s.success?n(s=>s.map(s=>s.id===e.id?c(r({},s),{isActive:!s.isActive}):s)):g(s.error||"Failed to update business")}catch(s){g("Failed to update business")}}))(s),children:s.isActive?e("Admin.businessManagement.deactivate"):e("Admin.businessManagement.activate")}),o.jsxs(Z,{onClick:()=>(e=>d(null,null,function*(){if(confirm(`Are you sure you want to delete the business "${e.name}"?`))try{const s=yield Y(e.id);s.success?n(s=>s.filter(s=>s.id!==e.id)):g(s.error||"Failed to delete business")}catch(s){g("Failed to delete business")}}))(s),className:"text-red-600",children:[o.jsx(j,{className:"me-2 h-4 w-4"}),e("Admin.businessManagement.delete")]})]})]})})]},s.id);var a})})]})}),N&&o.jsx(ue,{business:N,isOpen:C,onClose:()=>{k(!1),A(null)},onSuccess:()=>{E(),k(!1),A(null)}}),o.jsx(ge,{isOpen:U,onClose:()=>O(!1),selectedCount:F.length,onApply:(s,n)=>d(null,null,function*(){if(0!==F.length)try{const a=yield ne(F,s,n);a.success?(yield E(),B([]),alert(e("Admin.businessManagement.bulkUpdateSuccess",{count:F.length}))):g(a.error||e("Admin.businessManagement.bulkUpdateError"))}catch(a){g(e("Admin.businessManagement.bulkUpdateError"))}})})]})}function xe(){const{t:e}=M();return o.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[o.jsxs("div",{className:"text-start order-last md:order-first",children:[o.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-start",children:e("Admin.businessManagement.title")}),o.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base text-start",children:e("Admin.businessManagement.description")})]}),o.jsx("div",{className:"order-first md:order-last",children:o.jsx(me,{})})]}),o.jsx(he,{})]})}function pe(){return o.jsx(xe,{})}export{pe as default};
