var e=(e,s,t)=>new Promise((n,a)=>{var l=e=>{try{m(t.next(e))}catch(s){a(s)}},i=e=>{try{m(t.throw(e))}catch(s){a(s)}},m=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,i);m((t=t.apply(e,s)).next())});import{j as s,aa as t,ad as n,D as a,S as l,a1 as i}from"./ui-vendor-NJW5rtDU.js";import{r as m}from"./react-vendor-7nhe2WMs.js";import{u as c,G as r,J as d,B as o,K as x,M as h,N as u,D as j,r as g,s as v,t as p,Q as f,E as N,aD as y,aE as A,I as b,d as w}from"./index-DR4W6oDl.js";import{T as P,a as M,b as C,c as S,d as _,e as k}from"./table-BjDYCMyB.js";function D({commentId:a,content:l}){const{t:i}=c(),[A,b]=m.useState(!1),[w,P]=m.useState(!1),[M,C]=m.useState(!1),[S,_]=m.useState(null);return s.jsxs("div",{className:"relative",children:[s.jsxs(r,{open:A,onOpenChange:b,children:[s.jsx(d,{asChild:!0,children:s.jsxs(o,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:i("Admin.commentActions.actions")})]})}),s.jsxs(x,{align:"end",children:[s.jsx(h,{children:i("Admin.commentActions.actions")}),s.jsxs(u,{onClick:()=>{b(!1),setTimeout(()=>P(!0),10)},className:"text-red-600 hover:text-red-700 focus:text-red-700",children:[s.jsx(n,{className:"h-4 w-4 me-2"}),i("Admin.commentActions.delete")]})]})]}),s.jsx(j,{open:w,onOpenChange:e=>{e||_(null),P(e)},children:s.jsxs(g,{className:"sm:max-w-md",children:[s.jsxs(v,{children:[s.jsx(p,{children:i("Admin.commentActions.deleteTitle")}),s.jsx(f,{children:i("Admin.commentActions.deleteMessage")})]}),s.jsx("div",{className:"my-4 p-3 bg-gray-50 rounded border",children:s.jsxs("p",{className:"text-sm text-gray-700",children:[s.jsx("strong",{children:i("Admin.commentActions.comment")})," ",l]})}),S&&s.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:S}),s.jsxs(N,{children:[s.jsx(o,{variant:"outline",onClick:()=>P(!1),children:i("Admin.commentActions.cancel")}),s.jsx(o,{variant:"destructive",onClick:()=>e(null,null,function*(){C(!0),_(null);try{const e=yield y(a);e.success?(P(!1),window.location.reload()):_(e.error||"Failed to delete comment")}catch(e){_("Failed to delete comment")}finally{C(!1)}}),disabled:M,children:i(M?"Admin.commentActions.deleting":"Admin.commentActions.deleteCommentButton")})]})]})})]})}function L(){const{t:t}=c(),[n,r]=m.useState([]),[d,x]=m.useState([]),[h,u]=m.useState(!0),[j,g]=m.useState(null),[v,p]=m.useState(""),[f,N]=m.useState(!1);m.useEffect(()=>{y()},[]),m.useEffect(()=>{L()},[n,v,f]);const y=()=>e(null,null,function*(){try{u(!0);const e=yield A();r(e)}catch(e){g("Failed to fetch comments")}finally{u(!1)}}),L=()=>{let e=[...n];if(v){const s=v.toLowerCase();e=e.filter(e=>{var t,n,a,l,i;return(null==(t=e.content)?void 0:t.toLowerCase().includes(s))||(null==(n=e.user_name)?void 0:n.toLowerCase().includes(s))||(null==(a=e.user_email)?void 0:a.toLowerCase().includes(s))||(null==(i=null==(l=e.advertisement)?void 0:l.title)?void 0:i.toLowerCase().includes(s))})}f&&(e=e.filter(e=>e.is_approved)),x(e)},E=e=>{const s=new Date(e);return new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)};return h?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx(a,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500",children:t("Admin.loading")})]})}):j?s.jsx("div",{className:"p-4 rounded border border-red-400 bg-red-100 text-red-700",children:j}):s.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[s.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:s.jsxs("div",{className:"text-start",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-start",children:t("Admin.commentsManagementPage.title")}),s.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base text-start",children:t("Admin.commentsManagementPage.description")})]})}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(l,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(b,{placeholder:t("Admin.commentsManagementPage.searchPlaceholder"),value:v,onChange:e=>p(e.target.value),className:"ps-10"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{variant:f?"outline":"default",onClick:()=>N(!1),size:"sm",children:t("Admin.commentsManagementPage.filters.all")}),s.jsx(o,{variant:f?"default":"outline",onClick:()=>N(!0),size:"sm",children:t("Admin.commentsManagementPage.filters.approvedOnly")})]})]}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(P,{children:[s.jsx(M,{children:s.jsxs(C,{children:[s.jsx(S,{children:t("Admin.commentsManagementPage.table.user")}),s.jsx(S,{children:t("Admin.commentsManagementPage.table.content")}),s.jsx(S,{children:t("Admin.commentsManagementPage.table.rating")}),s.jsx(S,{children:t("Admin.commentsManagementPage.table.adService")}),s.jsx(S,{children:t("Admin.commentsManagementPage.table.status")}),s.jsx(S,{children:t("Admin.commentsManagementPage.table.created")}),s.jsx(S,{className:"w-[50px]",children:t("Admin.commentsManagementPage.table.actions")})]})}),s.jsx(_,{children:0===d.length?s.jsx(C,{children:s.jsx(k,{colSpan:7,className:"text-center py-8 text-gray-500",children:t("Admin.commentsManagementPage.table.noComments")})}):d.map(e=>{var n,a;return s.jsxs(C,{children:[s.jsx(k,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-medium",children:e.user_name||"Anonymous"}),e.user_email&&s.jsx("div",{className:"text-sm text-gray-500",children:e.user_email})]})}),s.jsx(k,{className:"max-w-xs",children:s.jsx("div",{className:"truncate",title:e.content,children:e.content})}),s.jsx(k,{children:e.rating>0?(a=e.rating,s.jsxs("div",{className:"flex items-center gap-0.5",children:[[1,2,3,4,5].map(e=>s.jsx(i,{className:"h-4 w-4 "+(e<=a?"fill-yellow-400 text-yellow-400":"text-gray-300")},e)),s.jsxs("span",{className:"ms-1 text-sm text-gray-600",children:["(",a,")"]})]})):s.jsx("span",{className:"text-gray-400 text-sm",children:t("Admin.commentsManagementPage.table.noRating")})}),s.jsx(k,{children:(null==(n=e.advertisement)?void 0:n.title)?s.jsx(w,{variant:"outline",children:e.advertisement.title}):s.jsx("span",{className:"text-gray-400 text-sm",children:t("Admin.commentsManagementPage.table.generalComment")})}),s.jsx(k,{children:s.jsx(w,{variant:e.is_approved?"default":"secondary",children:e.is_approved?t("Admin.commentsManagementPage.table.approved"):t("Admin.commentsManagementPage.table.pending")})}),s.jsx(k,{className:"text-sm text-gray-500",children:E(e.created_at)}),s.jsx(k,{children:s.jsx(D,{commentId:e.id,content:e.content})})]},e.id)})})]})}),s.jsx("div",{className:"text-sm text-gray-500",children:t("Admin.commentsManagementPage.resultsCount",{count:d.length})})]})}export{L as default};
