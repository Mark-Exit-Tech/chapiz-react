var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,a,n)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,d=(e,s)=>{for(var a in s||(s={}))t.call(s,a)&&i(e,a,s[a]);if(n)for(var a of n(s))r.call(s,a)&&i(e,a,s[a]);return e},l=(e,n)=>s(e,a(n)),o=(e,s,a)=>new Promise((n,t)=>{var r=e=>{try{d(a.next(e))}catch(s){t(s)}},i=e=>{try{d(a.throw(e))}catch(s){t(s)}},d=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,i);d((a=a.apply(e,s)).next())});import{j as m,ac as c,aa as u,t as h,ad as p}from"./ui-vendor-NJW5rtDU.js";import{M as x}from"./MediaUpload-DSeSwC9g.js";import{u as j,Z as g,D as b,q as y,B as v,r as f,s as w,t as N,L as A,I as D,T as M,E as U,_ as S,$ as I,a0 as P,a1 as C,d as F,G as O,J as k,K as B,N as E,a2 as T}from"./index-DR4W6oDl.js";import{B as q}from"./business-multiselect-DNptQaqr.js";import{r as L}from"./react-vendor-7nhe2WMs.js";import{T as G,a as R,b as Y,c as H,d as J,e as K}from"./table-BjDYCMyB.js";function Z(){const{t:e}=j(),[s,a]=L.useState(!1),[n,t]=L.useState({name:"",description:"",imageUrl:"",youtubeUrl:"",businessIds:[],startDate:"",endDate:""}),[r,i]=L.useState(!1),[c,u]=L.useState(null),[h,p]=L.useState([]),[I,P]=L.useState(!1);L.useEffect(()=>{s&&C()},[s]);const C=()=>o(null,null,function*(){P(!0);try{const e=yield g();e.success&&p(e.businesses)}catch(e){}finally{P(!1)}}),F=e=>{const{name:s,value:a}=e.target;t(e=>l(d({},e),{[s]:a}))};return m.jsxs(b,{open:s,onOpenChange:a,children:[m.jsx(y,{asChild:!0,children:m.jsx(v,{children:e("Admin.promoManagement.addNewPromo")})}),m.jsxs(f,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[m.jsx(w,{children:m.jsx(N,{children:e("Admin.promoManagement.addNewPromo")})}),c&&m.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:c}),m.jsxs("form",{onSubmit:e=>o(null,null,function*(){e.preventDefault(),i(!0),u(null);try{const e=yield S({name:n.name,description:n.description,imageUrl:n.imageUrl,youtubeUrl:n.youtubeUrl||void 0,businessIds:n.businessIds.length>0?n.businessIds:void 0,startDate:n.startDate?new Date(n.startDate):void 0,endDate:n.endDate?new Date(n.endDate):void 0});if(!e.success)throw new Error(e.error||"Failed to create promo");t({name:"",description:"",imageUrl:"",youtubeUrl:"",businessIds:[],startDate:"",endDate:""}),a(!1),window.location.reload()}catch(s){u(s.message||"Failed to create promo. Please try again.")}finally{i(!1)}}),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"name",children:e("Admin.promoManagement.name")}),m.jsx(D,{id:"name",name:"name",value:n.name,onChange:F,placeholder:e("Admin.promoManagement.namePlaceholder"),required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"description",children:e("Admin.promoManagement.description")}),m.jsx(M,{id:"description",name:"description",value:n.description,onChange:F,placeholder:e("Admin.promoManagement.descriptionPlaceholder"),rows:3,required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"imageUrl",children:e("Admin.promoManagement.image")}),m.jsx(x,{type:"image",value:n.imageUrl,onChange:e=>{t(s=>l(d({},s),{imageUrl:e}))},className:"w-1/5"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"youtubeUrl",children:e("Admin.promoManagement.youtubeUrl")||"YouTube URL (Optional)"}),m.jsx(D,{id:"youtubeUrl",name:"youtubeUrl",value:n.youtubeUrl,onChange:F,placeholder:e("Admin.promoManagement.youtubeUrlPlaceholder")||"https://www.youtube.com/watch?v=..."}),m.jsx("p",{className:"text-xs text-gray-500",children:e("Admin.promoManagement.youtubeUrlHint")||"If provided, the video will be shown instead of the image"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{children:e("Admin.promoManagement.business")||"Businesses (Optional)"}),m.jsx(q,{businesses:h,selectedIds:n.businessIds,onSelectionChange:e=>{t(s=>l(d({},s),{businessIds:e}))},placeholder:e("Admin.promoManagement.businessPlaceholder")||"Select businesses (optional)",disabled:I})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"startDate",children:e("Admin.promoManagement.startDate")}),m.jsx(D,{id:"startDate",name:"startDate",type:"date",value:n.startDate,onChange:F})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"endDate",children:e("Admin.promoManagement.endDate")}),m.jsx(D,{id:"endDate",name:"endDate",type:"date",value:n.endDate,onChange:F})]})]}),m.jsxs(U,{children:[m.jsx(v,{type:"button",variant:"outline",onClick:()=>a(!1),children:e("common.cancel")}),m.jsx(v,{type:"submit",disabled:r,children:e(r?"Admin.promoManagement.creating":"Admin.promoManagement.createPromo")})]})]})]})]})}function $({promo:e,isOpen:s,onClose:a,onSuccess:n}){const{t:t}=j(),[r,i]=L.useState({name:"",description:"",imageUrl:"",youtubeUrl:"",businessIds:[],startDate:"",endDate:""}),[c,u]=L.useState(!1),[h,p]=L.useState(null),[y,S]=L.useState([]),[P,C]=L.useState(!1);L.useEffect(()=>{if(s&&(F(),e)){const s=e.businessIds||(e.businessId?[e.businessId]:[]);i({name:e.name||"",description:e.description||"",imageUrl:e.imageUrl||"",youtubeUrl:e.youtubeUrl||"",businessIds:s,startDate:e.startDate?new Date(e.startDate).toISOString().split("T")[0]:"",endDate:e.endDate?new Date(e.endDate).toISOString().split("T")[0]:""})}},[s,e]);const F=()=>o(null,null,function*(){C(!0);try{const e=yield g();e.success&&S(e.businesses)}catch(e){}finally{C(!1)}}),O=e=>{const{name:s,value:a}=e.target;i(e=>l(d({},e),{[s]:a}))};return m.jsx(b,{open:s,onOpenChange:a,children:m.jsxs(f,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[m.jsx(w,{children:m.jsx(N,{children:t("Admin.dialogs.editPromo.title")})}),h&&m.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:h}),m.jsxs("form",{onSubmit:s=>o(null,null,function*(){s.preventDefault(),u(!0),p(null);try{const s=yield I(e.id,{name:r.name,description:r.description,imageUrl:r.imageUrl,youtubeUrl:r.youtubeUrl||void 0,businessIds:r.businessIds.length>0?r.businessIds:void 0,startDate:r.startDate?new Date(r.startDate):void 0,endDate:r.endDate?new Date(r.endDate):void 0});if(!s.success)throw new Error(s.error||"Failed to update promo");n(),a()}catch(t){p(t.message||"Failed to update promo. Please try again.")}finally{u(!1)}}),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"name",children:t("Admin.promoManagement.name")}),m.jsx(D,{id:"name",name:"name",value:r.name,onChange:O,placeholder:t("Admin.promoManagement.namePlaceholder"),required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"description",children:t("Admin.promoManagement.description")}),m.jsx(M,{id:"description",name:"description",value:r.description,onChange:O,placeholder:t("Admin.promoManagement.descriptionPlaceholder"),rows:3,required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"imageUrl",children:t("Admin.promoManagement.image")}),m.jsx(x,{type:"image",value:r.imageUrl,onChange:e=>{i(s=>l(d({},s),{imageUrl:e}))},className:"w-1/5"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"youtubeUrl",children:t("Admin.promoManagement.youtubeUrl")||"YouTube URL (Optional)"}),m.jsx(D,{id:"youtubeUrl",name:"youtubeUrl",value:r.youtubeUrl,onChange:O,placeholder:t("Admin.promoManagement.youtubeUrlPlaceholder")||"https://www.youtube.com/watch?v=..."})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{children:t("Admin.promoManagement.business")||"Businesses (Optional)"}),m.jsx(q,{businesses:y,selectedIds:r.businessIds,onSelectionChange:e=>{i(s=>l(d({},s),{businessIds:e}))},placeholder:t("Admin.promoManagement.businessPlaceholder")||"Select businesses (optional)",disabled:P})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"startDate",children:t("Admin.promoManagement.startDate")}),m.jsx(D,{id:"startDate",name:"startDate",type:"date",value:r.startDate,onChange:O})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(A,{htmlFor:"endDate",children:t("Admin.promoManagement.endDate")}),m.jsx(D,{id:"endDate",name:"endDate",type:"date",value:r.endDate,onChange:O})]})]}),m.jsxs(U,{children:[m.jsx(v,{type:"button",variant:"outline",onClick:a,children:t("Admin.dialogs.editPromo.cancel")}),m.jsx(v,{type:"submit",disabled:c,children:t(c?"Admin.dialogs.editPromo.updating":"Admin.dialogs.editPromo.update")})]})]})]})})}function _(){const{t:e}=j(),[s,a]=L.useState([]),[n,t]=L.useState([]),[r,i]=L.useState(!0),[x,b]=L.useState(null),[y,f]=L.useState(null),[w,N]=L.useState(!1);L.useEffect(()=>{A()},[]);const A=()=>o(null,null,function*(){try{i(!0);const[e,s]=yield Promise.all([P(),g()]);e.success?a(e.promos):b(e.error||"Failed to fetch promos"),s.success&&t(s.businesses)}catch(e){b("Failed to fetch data")}finally{i(!1)}}),D=s=>{const a=s.businessIds||(s.businessId?[s.businessId]:[]);return 0===a.length?[e("Admin.promoManagement.unknownBusiness")]:a.map(s=>{const a=n.find(e=>e.id===s);return a?a.name:e("Admin.promoManagement.unknownBusiness")})};return r?m.jsx("div",{className:"flex items-center justify-center p-8",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),m.jsx("p",{className:"text-gray-500",children:"Loading..."})]})}):x?m.jsx("div",{className:"p-4 rounded border border-red-400 bg-red-100 text-red-700",children:x}):m.jsxs("div",{className:"space-y-4",children:[m.jsx("div",{className:"rounded-md border",children:m.jsxs(G,{children:[m.jsx(R,{children:m.jsxs(Y,{children:[m.jsx(H,{children:e("Admin.promoManagement.name")}),m.jsx(H,{children:e("Admin.promoManagement.image")}),m.jsx(H,{children:e("Admin.promoManagement.description")}),m.jsx(H,{children:e("Admin.promoManagement.business")}),m.jsx(H,{children:e("Admin.promoManagement.status")}),m.jsx(H,{children:e("Admin.promoManagement.createdAt")}),m.jsx(H,{className:"w-[50px]"})]})}),m.jsx(J,{children:0===s.length?m.jsx(Y,{children:m.jsx(K,{colSpan:7,className:"text-center py-8 text-gray-500",children:e("Admin.promoManagement.noPromos")})}):s.map(s=>{return m.jsxs(Y,{children:[m.jsx(K,{className:"font-medium",children:s.name}),m.jsx(K,{children:s.youtubeUrl?m.jsxs("div",{className:"relative w-16 h-10 rounded-md overflow-hidden",children:[m.jsx("img",{src:C(s.youtubeUrl)||"",alt:s.name,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:m.jsx(c,{className:"h-5 w-5 text-white"})})]}):s.imageUrl?m.jsx("div",{className:"w-16 h-10 rounded-md overflow-hidden",children:m.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover"})}):m.jsx("div",{className:"w-16 h-10 rounded-md bg-gray-100 flex items-center justify-center",children:m.jsx("img",{className:"h-5 w-5 text-gray-400"})})}),m.jsx(K,{className:"max-w-xs truncate",children:s.description}),m.jsx(K,{children:m.jsx("div",{className:"flex flex-wrap gap-1",children:D(s).map((e,s)=>m.jsx(F,{variant:"outline",children:e},s))})}),m.jsx(K,{children:m.jsx(F,{variant:s.isActive?"default":"secondary",children:s.isActive?e("Admin.adsManagement.status.active"):e("Admin.adsManagement.status.inactive")})}),m.jsx(K,{className:"text-sm text-gray-500",children:(n=s.createdAt,new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(n))}),m.jsx(K,{children:m.jsxs(O,{children:[m.jsx(k,{asChild:!0,children:m.jsx(v,{variant:"ghost",className:"h-8 w-8 p-0",children:m.jsx(u,{className:"h-4 w-4"})})}),m.jsxs(B,{align:"end",children:[m.jsxs(E,{onClick:()=>(e=>{f(e),N(!0)})(s),children:[m.jsx(h,{className:"me-2 h-4 w-4"}),e("Admin.promoManagement.edit")]}),m.jsx(E,{onClick:()=>(e=>o(null,null,function*(){try{const s=yield I(e.id,{isActive:!e.isActive});s.success?a(s=>s.map(s=>s.id===e.id?l(d({},s),{isActive:!s.isActive}):s)):b(s.error||"Failed to update promo")}catch(s){b("Failed to update promo")}}))(s),children:s.isActive?e("Admin.promoManagement.deactivate"):e("Admin.promoManagement.activate")}),m.jsxs(E,{onClick:()=>(s=>o(null,null,function*(){if(confirm(e("Admin.promoManagement.confirmDelete",{name:s.name})))try{const e=yield T(s.id);e.success?a(e=>e.filter(e=>e.id!==s.id)):b(e.error||"Failed to delete promo")}catch(n){b("Failed to delete promo")}}))(s),className:"text-red-600",children:[m.jsx(p,{className:"me-2 h-4 w-4"}),e("Admin.promoManagement.delete")]})]})]})})]},s.id);var n})})]})}),y&&m.jsx($,{promo:y,isOpen:w,onClose:()=>{N(!1),f(null)},onSuccess:()=>{A(),N(!1),f(null)}})]})}function z(){const{t:e}=j();return m.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[m.jsxs("div",{className:"text-start order-last md:order-first",children:[m.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-start",children:e("Admin.promoManagement.title")}),m.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base text-start",children:e("Admin.promoManagement.description")})]}),m.jsx("div",{className:"order-first md:order-last",children:m.jsx(Z,{})})]}),m.jsx(_,{})]})}export{z as default};
