var e=Object.defineProperty,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(s,n,r)=>n in s?e(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r,i=(e,i)=>{for(var t in i||(i={}))n.call(i,t)&&a(e,t,i[t]);if(s)for(var t of s(i))r.call(i,t)&&a(e,t,i[t]);return e},t=(e,s,n)=>new Promise((r,a)=>{var i=e=>{try{l(n.next(e))}catch(s){a(s)}},t=e=>{try{l(n.throw(e))}catch(s){a(s)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,t);l((n=n.apply(e,s)).next())});import{j as l,aa as d,P as c,z as o,i as m,D as u,S as x}from"./ui-vendor-NJW5rtDU.js";import{r as h,u as j}from"./react-vendor-7nhe2WMs.js";import{u as A,G as p,J as v,B as y,K as f,M as g,N,D as b,r as w,s as C,t as S,Q as M,L as P,w as k,x as E,y as U,z as O,A as _,I as D,E as I,T as R,ak as L,al as T,am as z,an as F,ao as B,ap as G,aq as $,ar as q,d as J}from"./index-DR4W6oDl.js";import{T as K,a as Q,b as V,c as H,d as W,e as X}from"./table-BjDYCMyB.js";import{C as Y}from"./checkbox-CkNnxXkh.js";function Z({userId:e,currentRole:s,isSuperAdmin:n,isRestricted:r,phoneNumber:a,userAddress:u}){const{t:x}=A(),[q,J]=h.useState(!1),[K,Q]=h.useState(!1),[V,H]=h.useState(s),[W,X]=h.useState(!1),[Z,ee]=h.useState(null),[se,ne]=h.useState(!1),[re,ae]=h.useState(!1),[ie,te]=h.useState(""),[le,de]=h.useState(!1),[ce,oe]=h.useState(a||""),[me,ue]=h.useState(u||""),[xe,he]=h.useState(!1),[je,Ae]=h.useState(!1),[pe,ve]=h.useState("100"),[ye,fe]=h.useState(""),[ge,Ne]=h.useState(!1),be=j(),we=()=>t(null,null,function*(){if(re){X(!0),ee(null);try{const s=yield L(e);s.success?(ne(!1),window.location.reload()):ee(s.error||x("Admin.userActions.deleteUserError"))}catch(s){ee(x("Admin.userActions.deleteUserError"))}finally{X(!1)}}else ne(!0)});return l.jsxs("div",{className:"relative",children:[l.jsxs(p,{open:K,onOpenChange:Q,children:[l.jsx(v,{asChild:!0,children:l.jsxs(y,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:[l.jsx(d,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:x("Admin.userActions.actions")})]})}),l.jsxs(f,{align:"end",children:[l.jsx(g,{children:x("Admin.userActions.actions")}),l.jsxs(N,{onClick:()=>{Q(!1),be(`/admin/users/${e}/pets`)},children:[l.jsx(c,{className:"h-4 w-4 me-2"}),x("Admin.userActions.viewUser")]}),l.jsx(N,{onClick:()=>t(null,null,function*(){Q(!1),he(!0);try{const s=yield $(e);s.success&&s.user&&(oe(s.user.phone||""),ue(s.user.address||""))}catch(s){}finally{he(!1),J(!0)}}),children:x("Admin.userActions.editUser")}),l.jsxs(N,{onClick:()=>{Q(!1),Ae(!0)},children:[l.jsx(o,{className:"h-4 w-4 me-2"}),x("Admin.userActions.addPoints")]}),!n&&l.jsx(N,{onClick:()=>{Q(!1),setTimeout(()=>we(),10)},className:"text-red-600 hover:text-red-700 focus:text-red-700",children:x("Admin.userActions.deleteUser")})]})]}),l.jsx(b,{open:q,onOpenChange:e=>{e||(H(s),ee(null)),J(e)},children:l.jsxs(w,{className:"sm:max-w-md",children:[l.jsxs(C,{children:[l.jsx(S,{children:x("Admin.userActions.editUser")}),l.jsx(M,{children:x("Admin.userActions.editUserDescription")})]}),Z&&l.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:Z}),l.jsx("div",{className:"grid gap-4 py-4",children:xe?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(P,{children:x("Admin.userActions.userRole")}),l.jsxs(k,{value:V,onValueChange:e=>H(e),children:[l.jsx(E,{children:l.jsx(U,{placeholder:x("Admin.userActions.selectRole")})}),l.jsxs(O,{children:[l.jsx(_,{value:"user",children:x("Admin.userActions.roles.user")}),l.jsx(_,{value:"admin",children:x("Admin.userActions.roles.admin")}),l.jsx(_,{value:"super_admin",children:x("Admin.userActions.roles.super_admin")})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(P,{children:x("Admin.userActions.phoneNumber")}),l.jsxs("div",{className:"relative",children:[l.jsx(m,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),l.jsx(D,{type:"tel",value:ce,onChange:e=>oe(e.target.value),placeholder:x("Admin.userActions.enterPhone"),className:"ps-10"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(P,{children:x("Admin.userActions.address")}),l.jsx("div",{className:"relative",children:l.jsx(D,{type:"text",value:me,onChange:e=>ue(e.target.value),placeholder:x("Admin.userActions.enterAddress")})})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(P,{children:x("Admin.userActions.accountStatus")}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(Y,{checked:!r,onCheckedChange:s=>{(s=>{t(null,null,function*(){X(!0),ee(null);try{s?yield T(e):yield z(e,""),window.location.reload()}catch(n){ee(n instanceof Error?n.message:x("Admin.userActions.updateRestrictionError"))}finally{X(!1)}})})(!0===s)}}),l.jsx("span",{children:x(r?"Admin.userActions.restricted":"Admin.userActions.active")})]})]})]})}),l.jsxs(I,{className:"flex space-x-2",children:[l.jsx(y,{variant:"outline",onClick:()=>J(!1),children:x("Admin.userActions.cancel")}),l.jsx(y,{onClick:()=>t(null,null,function*(){X(!0),ee(null);try{if(V!==s&&(yield F(e,V)),ce!==a||me!==u){const s=yield B(e,i(i({},ce!==a?{phone:ce}:{}),me!==u?{address:me}:{}));if(!s.success)throw new Error(s.error||x("Admin.userActions.updateUserInfoError"))}J(!1),window.location.reload()}catch(n){ee(n instanceof Error?n.message:x("Admin.userActions.saveChangesError"))}finally{X(!1)}}),disabled:W||xe,children:x(W?"Admin.userActions.savingChanges":"Admin.userActions.saveChanges")})]})]})}),l.jsx(b,{open:se,onOpenChange:e=>{e||(ae(!1),ee(null)),ne(e)},children:l.jsxs(w,{className:"sm:max-w-md",children:[l.jsxs(C,{children:[l.jsx(S,{children:x("Admin.userActions.confirmDeletion")}),l.jsx(M,{children:x("Admin.userActions.deleteUserMessage")})]}),l.jsxs(I,{children:[l.jsx(y,{variant:"outline",onClick:()=>ne(!1),children:x("Admin.userActions.cancel")}),l.jsx(y,{variant:"destructive",onClick:()=>{ae(!0),we()},children:x("Admin.userActions.deleteUser")})]})]})}),l.jsx(b,{open:je,onOpenChange:e=>{e||(ve("100"),fe(""),ee(null)),Ae(e)},children:l.jsxs(w,{className:"sm:max-w-md",children:[l.jsxs(C,{children:[l.jsx(S,{children:x("Admin.userActions.addPoints")}),l.jsx(M,{children:x("Admin.userActions.addPointsDescription")})]}),Z&&l.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:Z}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(P,{children:x("Admin.userActions.pointsAmount")}),l.jsx(D,{type:"number",min:"1",value:pe,onChange:e=>ve(e.target.value),placeholder:"100"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(P,{children:[x("Admin.userActions.description")," (",x("Admin.userActions.optional"),")"]}),l.jsx(R,{value:ye,onChange:e=>fe(e.target.value),placeholder:x("Admin.userActions.pointsDescriptionPlaceholder"),rows:3})]})]}),l.jsxs(I,{children:[l.jsx(y,{variant:"outline",onClick:()=>Ae(!1),children:x("Admin.userActions.cancel")}),l.jsx(y,{onClick:()=>t(null,null,function*(){const s=parseInt(pe);if(isNaN(s)||s<=0)ee(x("Admin.userActions.invalidPointsAmount"));else{Ne(!0),ee(null);try{const n=yield G(e,s,ye||void 0);n.success?(Ae(!1),ve("100"),fe(""),window.location.reload()):ee(n.error||x("Admin.userActions.addPointsError"))}catch(n){ee(x("Admin.userActions.addPointsError"))}finally{Ne(!1)}}}),disabled:ge,children:x(ge?"Admin.userActions.addingPoints":"Admin.userActions.addPoints")})]})]})})]})}function ee(){const{t:e}=A(),[s,n]=h.useState([]),[r,a]=h.useState([]),[i,d]=h.useState(!0),[c,o]=h.useState(null),[m,j]=h.useState("");h.useEffect(()=>{p()},[]),h.useEffect(()=>{v()},[s,m]);const p=()=>t(null,null,function*(){try{d(!0);const e=yield q();n(e)}catch(e){o("Failed to fetch users")}finally{d(!1)}}),v=()=>{let e=[...s];if(m){const s=m.toLowerCase();e=e.filter(e=>{var n,r,a,i;return(null==(n=e.email)?void 0:n.toLowerCase().includes(s))||(null==(r=e.name)?void 0:r.toLowerCase().includes(s))||(null==(a=e.display_name)?void 0:a.toLowerCase().includes(s))||(null==(i=e.phone)?void 0:i.toLowerCase().includes(s))})}a(e)},y=e=>{const s=new Date(e);return new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric"}).format(s)},f=e=>{switch(e){case"super_admin":return"destructive";case"admin":return"default";default:return"secondary"}};return i?l.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:l.jsxs("div",{className:"text-center",children:[l.jsx(u,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-gray-500",children:e("Admin.loading")})]})}):c?l.jsx("div",{className:"p-4 rounded border border-red-400 bg-red-100 text-red-700",children:c}):l.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[l.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:l.jsxs("div",{className:"text-start",children:[l.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-start",children:e("Admin.usersManagement.title")}),l.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base text-start",children:e("Admin.manageUsersDescription")})]})}),l.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:l.jsxs("div",{className:"relative flex-1",children:[l.jsx(x,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),l.jsx(D,{placeholder:e("Admin.usersManagement.searchPlaceholder"),value:m,onChange:e=>j(e.target.value),className:"ps-10"})]})}),l.jsx("div",{className:"rounded-md border",children:l.jsxs(K,{children:[l.jsx(Q,{children:l.jsxs(V,{children:[l.jsx(H,{children:e("Admin.usersManagement.table.name")}),l.jsx(H,{children:e("Admin.usersManagement.table.email")}),l.jsx(H,{children:e("Admin.usersManagement.table.phone")}),l.jsx(H,{children:e("Admin.usersManagement.table.role")}),l.jsx(H,{children:e("Admin.usersManagement.table.points")}),l.jsx(H,{children:e("Admin.usersManagement.table.status")}),l.jsx(H,{children:e("Admin.usersManagement.table.joined")}),l.jsx(H,{className:"w-[50px]",children:e("Admin.usersManagement.table.actions")})]})}),l.jsx(W,{children:0===r.length?l.jsx(V,{children:l.jsx(X,{colSpan:8,className:"text-center py-8 text-gray-500",children:e("Admin.usersManagement.table.noUsers")})}):r.map(s=>l.jsxs(V,{children:[l.jsx(X,{className:"font-medium",children:s.name||s.display_name||"-"}),l.jsx(X,{children:s.email}),l.jsx(X,{children:s.phone||"-"}),l.jsx(X,{children:l.jsx(J,{variant:f(s.role),children:e(`Admin.usersManagement.roles.${s.role}`)||s.role})}),l.jsx(X,{children:s.points||0}),l.jsx(X,{children:l.jsx(J,{variant:s.is_restricted?"destructive":"default",children:s.is_restricted?e("Admin.usersManagement.table.restricted"):e("Admin.usersManagement.table.active")})}),l.jsx(X,{className:"text-sm text-gray-500",children:y(s.created_at)}),l.jsx(X,{children:l.jsx(Z,{userId:s.uid||s.id,currentRole:s.role,isSuperAdmin:"super_admin"===s.role,isRestricted:s.is_restricted,phoneNumber:s.phone,userAddress:s.address})})]},s.id))})]})}),l.jsx("div",{className:"text-sm text-gray-500",children:e("Admin.usersManagement.resultsCount",{count:r.length})})]})}export{ee as default};
