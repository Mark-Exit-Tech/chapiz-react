const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DR4W6oDl.js","assets/ui-vendor-NJW5rtDU.js","assets/react-vendor-7nhe2WMs.js","assets/index-BZtyA-E3.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,t=(s,n,a)=>n in s?e(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a,l=(e,s)=>{for(var n in s||(s={}))i.call(s,n)&&t(e,n,s[n]);if(a)for(var n of a(s))r.call(s,n)&&t(e,n,s[n]);return e},o=(e,a)=>s(e,n(a)),c=(e,s,n)=>new Promise((a,i)=>{var r=e=>{try{l(n.next(e))}catch(s){i(s)}},t=e=>{try{l(n.throw(e))}catch(s){i(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,t);l((n=n.apply(e,s)).next())});import{j as d,aa as m,l as p,t as u,ad as h}from"./ui-vendor-NJW5rtDU.js";import{u as x,D as j,q as v,B as g,r as y,s as f,t as N,L as b,I as w,T as A,E as F,a3 as M,Z as C,a4 as I,a5 as S,a6 as T,d as L,G as P,J as D,K as U,N as O,a7 as E}from"./index-DR4W6oDl.js";import{r as k}from"./react-vendor-7nhe2WMs.js";import{M as q}from"./MediaUpload-DSeSwC9g.js";import{T as B,a as _,b as G,c as H,d as K,e as J}from"./table-BjDYCMyB.js";import{B as R}from"./business-multiselect-DNptQaqr.js";function V(){const{t:e}=x(),[s,n]=k.useState(!1),[a,i]=k.useState({name:"",description:"",price:"",points:"",imageUrl:"",validFrom:"",validTo:"",purchaseLimit:""}),[r,t]=k.useState(!1),[m,p]=k.useState(null),u=e=>{const{name:s,value:n}=e.target;i(e=>o(l({},e),{[s]:n}))};return d.jsxs(j,{open:s,onOpenChange:n,children:[d.jsx(v,{asChild:!0,children:d.jsx(g,{children:e("Admin.couponsManagement.addNewCoupon")})}),d.jsxs(y,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[d.jsx(f,{children:d.jsx(N,{children:e("Admin.couponsManagement.addNewCoupon")})}),m&&d.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:m}),d.jsxs("form",{onSubmit:e=>c(null,null,function*(){e.preventDefault(),t(!0),p(null);try{const e=""===a.price?0:parseFloat(a.price);let s=parseInt(a.points);if(isNaN(s)&&0===e&&(s=0),isNaN(e)||e<0)throw new Error("Please enter a valid price (0 for free vouchers)");if(isNaN(s)||s<0)throw new Error("Please enter valid points");const r=""===a.purchaseLimit?void 0:parseInt(a.purchaseLimit);if(void 0!==r&&(isNaN(r)||r<1))throw new Error("Purchase limit must be a positive number or left empty for unlimited");const t=yield M({name:a.name,description:a.description,price:e,points:s,imageUrl:a.imageUrl,validFrom:new Date(a.validFrom),validTo:new Date(a.validTo),purchaseLimit:r});if(!t.success)throw new Error(t.error||"Failed to create coupon");i({name:"",description:"",price:"",points:"",imageUrl:"",validFrom:"",validTo:"",purchaseLimit:""}),n(!1),window.location.reload()}catch(s){p(s.message||"Failed to create coupon. Please try again.")}finally{t(!1)}}),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"name",children:e("Admin.couponsManagement.name")}),d.jsx(w,{id:"name",name:"name",value:a.name,onChange:u,placeholder:e("Admin.couponsManagement.namePlaceholder"),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"description",children:e("Admin.couponsManagement.description")}),d.jsx(A,{id:"description",name:"description",value:a.description,onChange:u,placeholder:e("Admin.couponsManagement.descriptionPlaceholder"),rows:3,required:!0})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs(b,{htmlFor:"price",children:[e("Admin.couponsManagement.price")," (0 for free)"]}),d.jsx(w,{id:"price",name:"price",type:"number",step:"0.01",min:"0",value:a.price,onChange:u,placeholder:e("Admin.couponsManagement.pricePlaceholder")||"0.00 (leave empty or 0 for free)"})]}),""!==a.price&&parseFloat(a.price)>0&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"points",children:e("Admin.couponsManagement.points")}),d.jsx(w,{id:"points",name:"points",type:"number",min:"0",value:a.points,onChange:u,placeholder:e("Admin.couponsManagement.pointsPlaceholder")})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"imageUrl",children:e("Admin.couponsManagement.image")}),d.jsx(q,{type:"image",value:a.imageUrl,onChange:e=>{i(s=>o(l({},s),{imageUrl:e}))},className:"w-1/5"})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"validFrom",children:e("Admin.couponsManagement.validFrom")}),d.jsx(w,{id:"validFrom",name:"validFrom",type:"datetime-local",value:a.validFrom,onChange:u,required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"validTo",children:e("Admin.couponsManagement.validTo")}),d.jsx(w,{id:"validTo",name:"validTo",type:"datetime-local",value:a.validTo,onChange:u,required:!0})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"purchaseLimit",children:e("Admin.couponsManagement.purchaseLimit")}),d.jsx(w,{id:"purchaseLimit",name:"purchaseLimit",type:"number",min:"1",value:a.purchaseLimit,onChange:u,placeholder:e("Admin.couponsManagement.purchaseLimitPlaceholder")}),d.jsx("p",{className:"text-xs text-gray-500",children:e("Admin.couponsManagement.purchaseLimitHelp")})]}),d.jsxs(F,{children:[d.jsx(g,{type:"button",variant:"outline",onClick:()=>n(!1),children:e("common.cancel")}),d.jsx(g,{type:"submit",disabled:r,children:e(r?"common.creating":"Admin.couponsManagement.createCoupon")})]})]})]})]})}function Z({coupon:e,isOpen:s,onClose:n,onSuccess:a}){const{t:i}=x("Admin"),[r,t]=k.useState({name:"",description:"",price:"",points:"",imageUrl:"",validFrom:"",validTo:"",businessIds:[],purchaseLimit:""}),[m,p]=k.useState(!1),[u,h]=k.useState(null),[v,M]=k.useState([]),[T,L]=k.useState(!1);k.useEffect(()=>{var n,a,i;if(s&&(P(),e)){const s=e.businessIds||(e.businessId?[e.businessId]:[]);t({name:e.name||"",description:e.description||"",price:(null==(n=e.price)?void 0:n.toString())||"",points:(null==(a=e.points)?void 0:a.toString())||"",imageUrl:e.imageUrl||"",validFrom:e.validFrom?new Date(e.validFrom).toISOString().slice(0,16):"",validTo:e.validTo?new Date(e.validTo).toISOString().slice(0,16):"",businessIds:s,purchaseLimit:(null==(i=e.purchaseLimit)?void 0:i.toString())||""})}},[s,e]);const P=()=>c(null,null,function*(){try{L(!0);const e=yield C();e.success&&e.businesses&&M(e.businesses)}catch(e){}finally{L(!1)}}),D=e=>{const{name:s,value:n}=e.target;t(e=>o(l({},e),{[s]:n}))};return d.jsx(j,{open:s,onOpenChange:n,children:d.jsxs(y,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[d.jsx(f,{children:d.jsx(N,{children:i("dialogs.editCoupon.title")})}),u&&d.jsx("div",{className:"mb-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:u}),d.jsxs("form",{onSubmit:s=>c(null,null,function*(){s.preventDefault(),p(!0),h(null);try{const s=""===r.price?0:parseFloat(r.price);let i=parseInt(r.points);if(isNaN(i)&&0===s&&(i=0),isNaN(s)||s<0)throw new Error("Please enter a valid price (0 for free vouchers)");if(isNaN(i)||i<0)throw new Error("Please enter valid points");const t=""===r.purchaseLimit?void 0:parseInt(r.purchaseLimit);if(void 0!==t&&(isNaN(t)||t<1))throw new Error("Purchase limit must be a positive number or left empty for unlimited");const l=yield I(e.id,{name:r.name,description:r.description,price:s,points:i,imageUrl:r.imageUrl,validFrom:new Date(r.validFrom),validTo:new Date(r.validTo),businessIds:r.businessIds.length>0?r.businessIds:void 0,purchaseLimit:t});if(!l.success)throw new Error(l.error||"Failed to update coupon");const{getCouponById:o}=yield S(()=>c(null,null,function*(){const{getCouponById:e}=yield import("./index-DR4W6oDl.js").then(e=>e.aK);return{getCouponById:e}}),__vite__mapDeps([0,1,2,3])),d=yield o(e.id);d.success&&d.coupon,a(),n()}catch(i){h(i.message||"Failed to update coupon. Please try again.")}finally{p(!1)}}),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"name",children:i("couponsManagement.name")}),d.jsx(w,{id:"name",name:"name",value:r.name,onChange:D,placeholder:i("couponsManagement.namePlaceholder"),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"description",children:i("couponsManagement.description")}),d.jsx(A,{id:"description",name:"description",value:r.description,onChange:D,placeholder:i("couponsManagement.descriptionPlaceholder"),rows:3,required:!0})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs(b,{htmlFor:"price",children:[i("couponsManagement.price")," (0 for free)"]}),d.jsx(w,{id:"price",name:"price",type:"number",step:"0.01",min:"0",value:r.price,onChange:D,placeholder:i("couponsManagement.pricePlaceholder")||"0.00 (leave empty or 0 for free)"})]}),""!==r.price&&parseFloat(r.price)>0&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"points",children:i("couponsManagement.points")}),d.jsx(w,{id:"points",name:"points",type:"number",value:r.points,onChange:D,placeholder:i("couponsManagement.pointsPlaceholder")})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"imageUrl",children:i("couponsManagement.image")}),d.jsx(q,{type:"image",value:r.imageUrl,onChange:e=>{t(s=>o(l({},s),{imageUrl:e}))},className:"w-1/5"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{children:i("couponsManagement.business")||"Businesses (Optional)"}),d.jsx(R,{businesses:v,selectedIds:r.businessIds,onSelectionChange:e=>{t(s=>o(l({},s),{businessIds:e}))},placeholder:i("couponsManagement.businessPlaceholder")||"Select businesses (optional)",disabled:T})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"validFrom",children:i("couponsManagement.validFrom")}),d.jsx(w,{id:"validFrom",name:"validFrom",type:"datetime-local",value:r.validFrom,onChange:D,required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"validTo",children:i("couponsManagement.validTo")}),d.jsx(w,{id:"validTo",name:"validTo",type:"datetime-local",value:r.validTo,onChange:D,required:!0})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(b,{htmlFor:"purchaseLimit",children:i("couponsManagement.purchaseLimit")}),d.jsx(w,{id:"purchaseLimit",name:"purchaseLimit",type:"number",min:"1",value:r.purchaseLimit,onChange:D,placeholder:i("couponsManagement.purchaseLimitPlaceholder")}),d.jsx("p",{className:"text-xs text-gray-500",children:i("couponsManagement.purchaseLimitHelp")})]}),d.jsxs(F,{children:[d.jsx(g,{type:"button",variant:"outline",onClick:n,children:i("dialogs.editCoupon.cancel")}),d.jsx(g,{type:"submit",disabled:m,children:i(m?"dialogs.editCoupon.updating":"dialogs.editCoupon.update")})]})]})]})})}function z(){const{t:e}=x(),[s,n]=k.useState([]),[a,i]=k.useState([]),[r,t]=k.useState(!0),[v,b]=k.useState(null),[w,A]=k.useState(null),[F,M]=k.useState(!1),[S,q]=k.useState(null);k.useEffect(()=>{R()},[]);const R=()=>c(null,null,function*(){yield Promise.all([z(),V()])}),V=()=>c(null,null,function*(){try{const e=yield C();e.success&&e.businesses&&i(e.businesses)}catch(e){}}),z=()=>c(null,null,function*(){try{t(!0);const e=yield T();if(e.success){const s=e.coupons.map(e=>o(l({},e),{createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date,validFrom:e.validFrom?new Date(e.validFrom):new Date,validTo:e.validTo?new Date(e.validTo):new Date}));n(s)}else b(e.error||"Failed to fetch coupons")}catch(e){b("Failed to fetch coupons")}finally{t(!1)}}),Q=e=>new Intl.NumberFormat("he-IL",{style:"currency",currency:"ILS"}).format(e),W=e=>{const s=e.businessIds||(e.businessId?[e.businessId]:[]);return 0===s.length?["General"]:s.map(e=>{const s=a.find(s=>s.id===e);return s?s.name:"Unknown"})},X=e=>{if(!e)return"N/A";let s;return s="string"==typeof e?new Date(e):e,isNaN(s.getTime())?"Invalid Date":new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)};return r?d.jsx("div",{className:"flex items-center justify-center p-8",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),d.jsx("p",{className:"text-gray-500",children:"Loading..."})]})}):v?d.jsx("div",{className:"p-4 rounded border border-red-400 bg-red-100 text-red-700",children:v}):d.jsxs("div",{className:"space-y-4",children:[d.jsx("div",{className:"rounded-md border",children:d.jsxs(B,{children:[d.jsx(_,{children:d.jsxs(G,{children:[d.jsx(H,{children:e("Admin.couponsManagement.name")}),d.jsx(H,{children:e("Admin.couponsManagement.description")}),d.jsx(H,{children:e("Admin.couponsManagement.business")||"Business"}),d.jsx(H,{children:e("Admin.couponsManagement.price")}),d.jsx(H,{children:e("Admin.couponsManagement.points")}),d.jsx(H,{children:e("Admin.couponsManagement.image")}),d.jsx(H,{children:e("Admin.couponsManagement.validPeriod")}),d.jsx(H,{children:e("Admin.couponsManagement.status")}),d.jsx(H,{className:"w-[50px]"})]})}),d.jsx(K,{children:0===s.length?d.jsx(G,{children:d.jsx(J,{colSpan:9,className:"text-center py-8 text-gray-500",children:e("Admin.couponsManagement.noCoupons")})}):s.map(s=>d.jsxs(G,{children:[d.jsx(J,{className:"font-medium",children:s.name}),d.jsx(J,{className:"max-w-xs truncate",children:s.description}),d.jsx(J,{children:d.jsx("div",{className:"flex flex-wrap gap-1",children:W(s).map((e,s)=>d.jsx(L,{variant:"outline",children:e},s))})}),d.jsx(J,{children:Q(s.price)}),d.jsx(J,{children:d.jsxs(L,{variant:"outline",children:[s.points," pts"]})}),d.jsx(J,{children:s.imageUrl?d.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>q(s),children:d.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-full object-cover"})}):d.jsx("div",{className:"w-10 h-10 rounded-md bg-gray-100 flex items-center justify-center",children:d.jsx("img",{className:"h-5 w-5 text-gray-400"})})}),d.jsx(J,{className:"text-sm",children:d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{children:["From: ",X(s.validFrom)]}),d.jsxs("div",{children:["To: ",X(s.validTo)]})]})}),d.jsx(J,{children:d.jsx(L,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})}),d.jsx(J,{children:d.jsxs(P,{children:[d.jsx(D,{asChild:!0,children:d.jsx(g,{variant:"ghost",className:"h-8 w-8 p-0",children:d.jsx(m,{className:"h-4 w-4"})})}),d.jsxs(U,{align:"end",children:[s.imageUrl&&d.jsxs(O,{onClick:()=>q(s),children:[d.jsx(p,{className:"me-2 h-4 w-4"}),e("Admin.couponsManagement.preview")||"Preview"]}),d.jsxs(O,{onClick:()=>(e=>{A(e),M(!0)})(s),children:[d.jsx(u,{className:"me-2 h-4 w-4"}),e("Admin.couponsManagement.edit")]}),d.jsx(O,{onClick:()=>(e=>c(null,null,function*(){try{const s=yield I(e.id,{isActive:!e.isActive});s.success?n(s=>s.map(s=>s.id===e.id?o(l({},s),{isActive:!s.isActive}):s)):b(s.error||"Failed to update coupon")}catch(s){b("Failed to update coupon")}}))(s),children:s.isActive?e("Admin.couponsManagement.deactivate"):e("Admin.couponsManagement.activate")}),d.jsxs(O,{onClick:()=>(s=>c(null,null,function*(){if(confirm(e("Admin.couponsManagement.confirmDelete",{name:s.name})))try{const e=yield E(s.id);e.success?n(e=>e.filter(e=>e.id!==s.id)):b(e.error||"Failed to delete coupon")}catch(a){b("Failed to delete coupon")}}))(s),className:"text-red-600",children:[d.jsx(h,{className:"me-2 h-4 w-4"}),e("Admin.couponsManagement.delete")]})]})]})})]},s.id))})]})}),w&&d.jsx(Z,{coupon:w,isOpen:F,onClose:()=>{M(!1),A(null)},onSuccess:()=>{z(),M(!1),A(null)}}),d.jsx(j,{open:!!S,onOpenChange:e=>!e&&q(null),children:d.jsx(y,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:S&&d.jsxs(d.Fragment,{children:[d.jsx(f,{children:d.jsx(N,{className:"text-2xl font-bold",children:S.name})}),d.jsxs("div",{className:"space-y-4",children:[S.imageUrl&&d.jsx("div",{className:"rounded-lg overflow-hidden bg-gray-100",children:d.jsx("img",{src:S.imageUrl,alt:S.name,className:"w-full h-auto object-contain max-h-[400px] mx-auto"})}),S.description&&d.jsx("div",{children:d.jsx("p",{className:"text-base text-gray-700",children:S.description})}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600",children:[e("Admin.couponsManagement.price"),": "]}),d.jsx("span",{children:Q(S.price)})]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600",children:[e("Admin.couponsManagement.points"),": "]}),d.jsxs("span",{children:[S.points," pts"]})]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600",children:[e("Admin.couponsManagement.validFrom"),": "]}),d.jsx("span",{children:X(S.validFrom)})]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600",children:[e("Admin.couponsManagement.validTo"),": "]}),d.jsx("span",{children:X(S.validTo)})]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600",children:[e("Admin.couponsManagement.status"),": "]}),d.jsx(L,{variant:S.isActive?"default":"secondary",children:S.isActive?"Active":"Inactive"})]})]}),W(S).length>0&&d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-gray-600 block mb-2",children:[e("Admin.couponsManagement.business"),":"]}),d.jsx("div",{className:"flex flex-wrap gap-2",children:W(S).map((e,s)=>d.jsx(L,{variant:"outline",children:e},s))})]})]})]})})})]})}function Q(){const{t:e}=x();return d.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[d.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[d.jsxs("div",{className:"text-start order-last md:order-first",children:[d.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 text-start",children:e("Admin.couponsManagement.title")}),d.jsx("p",{className:"text-gray-600 mt-2 text-sm md:text-base text-start",children:e("Admin.couponsManagement.description")})]}),d.jsx("div",{className:"order-first md:order-last",children:d.jsx(V,{})})]}),d.jsx(z,{})]})}export{Q as default};
