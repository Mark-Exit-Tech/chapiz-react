var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,i=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&n(e,r,t[r]);if(a)for(var r of a(t))l.call(t,r)&&n(e,r,t[r]);return e},o=(e,a)=>t(e,r(a)),c=(e,t)=>{var r={};for(var n in e)s.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&a)for(var n of a(e))t.indexOf(n)<0&&l.call(e,n)&&(r[n]=e[n]);return r},d=(e,t,r)=>new Promise((a,s)=>{var l=e=>{try{i(r.next(e))}catch(t){s(t)}},n=e=>{try{i(r.throw(e))}catch(t){s(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,n);i((r=r.apply(e,t)).next())});import{j as u,ag as h,q as m,ah as x,r as f,ai as p,aj as g,ak as v,al as y,am as w,an as j,a as b,X as N,t as C,ao as k,ap as S,aq as F}from"./ui-vendor-NJW5rtDU.js";import{af as R,c as P,u as E,D as z,r as I,s as M,t as U,B as $,X as A,ag as O,ah as T,ai as D,aj as L}from"./index-DR4W6oDl.js";import{r as _}from"./react-vendor-7nhe2WMs.js";function W(...e){const t=e[0];if(1===e.length)return t;const r=()=>{const r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const a=r.reduce((t,{useScope:r,scopeName:a})=>{const s=r(e)[`__scope${a}`];return i(i({},t),s)},{});return _.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}var B=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const r=R(`Primitive.${t}`),a=_.forwardRef((e,a)=>{const s=e,{asChild:l}=s,n=c(s,["asChild"]),d=l?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),u.jsx(d,o(i({},n),{ref:a}))});return a.displayName=`Primitive.${t}`,o(i({},e),{[t]:a})},{}),X="Progress",[V]=function(e,t=[]){let r=[];const a=()=>{const t=r.map(e=>_.createContext(e));return function(r){const a=(null==r?void 0:r[e])||t;return _.useMemo(()=>({[`__scope${e}`]:o(i({},r),{[e]:a})}),[r,a])}};return a.scopeName=e,[function(t,a){const s=_.createContext(a);s.displayName=t+"Context";const l=r.length;r=[...r,a];const n=t=>{var r;const a=t,{scope:n,children:i}=a,o=c(a,["scope","children"]),d=(null==(r=null==n?void 0:n[e])?void 0:r[l])||s,h=_.useMemo(()=>o,Object.values(o));return u.jsx(d.Provider,{value:h,children:i})};return n.displayName=t+"Provider",[n,function(r,n){var i;const o=(null==(i=null==n?void 0:n[e])?void 0:i[l])||s,c=_.useContext(o);if(c)return c;if(void 0!==a)return a;throw new Error(`\`${r}\` must be used within \`${t}\``)}]},W(a,...t)]}(X),[q,J]=V(X),Y=_.forwardRef((e,t)=>{const r=e,{__scopeProgress:a,value:s=null,max:l,getValueLabel:n=G}=r,d=c(r,["__scopeProgress","value","max","getValueLabel"]);(l||0===l)&&ee(l);const h=ee(l)?l:100;null!==s&&te(s,h);const m=te(s,h)?s:null,x=Z(m)?n(m,h):void 0;return u.jsx(q,{scope:a,value:m,max:h,children:u.jsx(B.div,o(i({"aria-valuemax":h,"aria-valuemin":0,"aria-valuenow":Z(m)?m:void 0,"aria-valuetext":x,role:"progressbar","data-state":Q(m,h),"data-value":null!=m?m:void 0,"data-max":h},d),{ref:t}))})});Y.displayName=X;var H="ProgressIndicator",K=_.forwardRef((e,t)=>{var r;const a=e,{__scopeProgress:s}=a,l=c(a,["__scopeProgress"]),n=J(H,s);return u.jsx(B.div,o(i({"data-state":Q(n.value,n.max),"data-value":null!=(r=n.value)?r:void 0,"data-max":n.max},l),{ref:t}))});function G(e,t){return`${Math.round(e/t*100)}%`}function Q(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function Z(e){return"number"==typeof e}function ee(e){return Z(e)&&!isNaN(e)&&e>0}function te(e,t){return Z(e)&&!isNaN(e)&&e<=t&&e>=0}K.displayName=H;var re=Y,ae=K;const se=_.forwardRef((e,t)=>{var r=e,{className:a,value:s}=r,l=c(r,["className","value"]);return u.jsx(re,o(i({ref:t,className:P("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",a)},l),{children:u.jsx(ae,{className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}))});se.displayName=re.displayName;const le=["#FF3B30","#FF9500","#FFCC00","#34C759","#007AFF","#5856D6","#AF52DE","#FFFFFF","#000000"],ne=["ðŸ˜€","ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ‘Ž","ðŸ”¥","â­","âœ…","âŒ","ðŸ’¯"];function ie({imageUrl:e,isOpen:t,onClose:r,onSave:a}){const{t:s}=E("pages.Admin.imageEditor"),{t:l}=E("common"),n=_.useRef(null),c=_.useRef(null),C=_.useRef(null),[k,S]=_.useState("select"),[F,R]=_.useState("default"),[P,O]=_.useState("#FF3B30"),[T,D]=_.useState(!1),[L,W]=_.useState([]),[B,X]=_.useState([]),[V,q]=_.useState(-1),[J,Y]=_.useState(!1),[H,K]=_.useState(!1),[G,Q]=_.useState(""),[Z,ee]=_.useState(null),[te,re]=_.useState(!1),[ae,se]=_.useState(null),[ie,oe]=_.useState(!1),[ce,de]=_.useState(null),[ue,he]=_.useState(null);_.useEffect(()=>{let r="";if(t&&e){(()=>d(null,null,function*(){try{const t=yield fetch(e,{mode:"cors",cache:"no-store"});if(!t.ok)throw new Error("Failed to fetch image");const a=yield t.blob();r=URL.createObjectURL(a);const s=new Image;s.onload=()=>{C.current=s,Y(!0),me()},s.onerror=()=>{A.error("Failed to load image")},s.src=r}catch(t){try{const t=`/api/proxy-image?url=${encodeURIComponent(e)}`,a=yield fetch(t);if(!a.ok)throw new Error("Proxy fetch failed");const s=yield a.blob();r=URL.createObjectURL(s);const l=new Image;l.onload=()=>{C.current=l,Y(!0),me()},l.onerror=()=>{throw new Error("Failed to load image from blob")},l.src=r}catch(a){const t=new Image;t.crossOrigin="anonymous";const r=e.includes("?")?`${e}&t=${Date.now()}`:`${e}?t=${Date.now()}`;t.onload=()=>{C.current=t,Y(!0),me()},t.onerror=()=>{A.error("Cannot edit this image due to security restrictions (CORS)")},t.src=r}}}))()}return()=>{r&&URL.revokeObjectURL(r)}},[t,e]);const me=()=>{const e=n.current,t=c.current,r=C.current;if(!e||!t||!r)return;let a=r.width,s=r.height;a>800&&(s=800*s/a,a=800),s>600&&(a=600*a/s,s=600),e.width=a,e.height=s,t.width=a,t.height=s;const l=e.getContext("2d");l&&l.drawImage(r,0,0,a,s)},xe=_.useCallback(e=>{const t=c.current;if(!t)return;const r=t.getContext("2d");if(!r)return;r.clearRect(0,0,t.width,t.height);(e||B.slice(0,V+1)).forEach(e=>{if("draw"===e.type&&e.points){if(r.strokeStyle=e.color,r.lineWidth="highlighter"===e.tool?20:"pen"===e.tool?3:2,r.lineCap="round",r.lineJoin="round","highlighter"===e.tool?r.globalAlpha=.3:r.globalAlpha=1,"arrow"===e.tool&&e.points.length>=2){const t=e.points[0],a=e.points[e.points.length-1];fe(r,t.x,t.y,a.x,a.y,e.color)}else r.beginPath(),r.moveTo(e.points[0].x,e.points[0].y),e.points.forEach(e=>r.lineTo(e.x,e.y)),r.stroke();r.globalAlpha=1}else if("text"===e.type&&e.text&&void 0!==e.x&&void 0!==e.y){const t=e.fontSize||24;r.fillStyle=e.color,r.font=`bold ${t}px Arial`,r.fillText(e.text,e.x,e.y)}else if("emoji"===e.type&&e.emoji&&void 0!==e.x&&void 0!==e.y){const t=e.fontSize||48;r.font=`${t}px Arial`,r.fillText(e.emoji,e.x,e.y)}else"blur"===e.type&&e.points&&e.points.forEach(e=>{r.filter="blur(10px)",r.fillStyle="rgba(0, 0, 0, 0.1)",r.fillRect(e.x-15,e.y-15,30,30),r.filter="none"})}),ae&&(r.save(),r.strokeStyle="#0ea5e9",r.setLineDash([6,6]),r.lineWidth=2,r.strokeRect(ae.x,ae.y,ae.width,ae.height),r.restore())},[B,V,ae]);_.useEffect(()=>{J&&xe()},[J,xe]);const fe=(e,t,r,a,s,l)=>{const n=Math.atan2(s-r,a-t);e.strokeStyle=l,e.lineWidth=3,e.beginPath(),e.moveTo(t,r),e.lineTo(a,s),e.stroke(),e.beginPath(),e.moveTo(a,s),e.lineTo(a-20*Math.cos(n-Math.PI/6),s-20*Math.sin(n-Math.PI/6)),e.moveTo(a,s),e.lineTo(a-20*Math.cos(n+Math.PI/6),s-20*Math.sin(n+Math.PI/6)),e.stroke()},pe=e=>{const t=c.current;if(!t)return{x:0,y:0};const r=t.getBoundingClientRect(),a=t.width/r.width,s=t.height/r.height;return{x:(e.clientX-r.left)*a,y:(e.clientY-r.top)*s}},ge=e=>{const t=c.current;if(!t)return{x:0,y:0};const r=t.getBoundingClientRect(),a=e.touches[0],s=t.width/r.width,l=t.height/r.height;return{x:(a.clientX-r.left)*s,y:(a.clientY-r.top)*l}},ve=(e,t,r=!1)=>{const a=document.createElement("canvas").getContext("2d");if(!a)return{width:0,height:t};a.font=`${r?"bold ":""}${t}px Arial`;return{width:a.measureText(e).width,height:t}},ye=e=>{var t,r;const a=B.slice(0,V+1);for(let s=a.length-1;s>=0;s--){const l=a[s];if("text"===l.type&&l.text||"emoji"===l.type&&l.emoji){const a=l.fontSize||("emoji"===l.type?48:24),n="text"===l.type?l.text:l.emoji,i="text"===l.type,{width:o,height:c}=ve(n,a,i),d=null!=(t=l.x)?t:0,u=null!=(r=l.y)?r:0,h=20,m=u-c-h,x=u+.25*c+h,f=d-h,p=d+o+h;if(e.x>=f&&e.x<=p&&e.y>=m&&e.y<=x)return{index:s,offset:{x:e.x-d,y:e.y-u}}}}return null},we=e=>{if("select"===k){const t=ye(e);return void(t&&(de(t.index),he(t.offset)))}return"text"===k?(ee(e),void re(!0)):"crop"===k?(oe(!0),void se({x:e.x,y:e.y,width:0,height:0})):void("emoji"!==k&&(D(!0),W([e])))},je=e=>{if("select"===k){if(null===ce||!ue)return;const t=B.slice(0,V+1);if(!t[ce])return;const r=[...t],a=r[ce];return r[ce]=o(i({},a),{x:e.x-ue.x,y:e.y-ue.y}),X(r),q(r.length-1),void xe(r)}if("crop"===k){if(!ie||!ae)return;const t=e.x-ae.x,r=e.y-ae.y;return se({x:t<0?e.x:ae.x,y:r<0?e.y:ae.y,width:Math.abs(t),height:Math.abs(r)}),void xe()}if(!T||"text"===k||"emoji"===k)return;W(t=>[...t,e]);const t=c.current;if(!t)return;xe();const r=t.getContext("2d");if(r){if(r.strokeStyle=P,r.lineWidth="highlighter"===k?20:"pen"===k?3:2,r.lineCap="round",r.lineJoin="round","highlighter"===k&&(r.globalAlpha=.3),"arrow"===k&&L.length>=2){const t=L[0],a=e;fe(r,t.x,t.y,a.x,a.y,P)}else"blur"===k?(r.filter="blur(10px)",r.fillStyle="rgba(0, 0, 0, 0.1)",r.fillRect(e.x-15,e.y-15,30,30),r.filter="none"):(r.beginPath(),r.moveTo(L[0].x,L[0].y),L.forEach(e=>r.lineTo(e.x,e.y)),r.stroke());r.globalAlpha=1}},be=()=>{if("select"===k)return de(null),void he(null);if("crop"!==k){if(T){if(D(!1),L.length>0){const e={type:"blur"===k?"blur":"draw",tool:k,color:P,points:L},t=B.slice(0,V+1);t.push(e),X(t),q(t.length-1)}W([])}}else ie&&oe(!1)},Ne=()=>{if(!G.trim()||!Z)return;const e={type:"text",tool:"text",color:P,text:G,x:Z.x,y:Z.y,fontSize:24},t=B.slice(0,V+1);t.push(e),X(t),q(t.length-1),Q(""),re(!1),ee(null),S("select")};return u.jsx(z,{open:t,onOpenChange:r,children:u.jsxs(I,{className:"max-w-6xl max-h-[95vh] p-0 gap-0",children:[u.jsx(M,{className:"px-6 py-4 border-b",children:u.jsx(U,{children:s("title")})}),u.jsxs("div",{className:"flex flex-col h-[calc(95vh-120px)]",children:[u.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gray-50",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx($,{variant:"select"===k?"default":"outline",size:"sm",onClick:()=>S("select"),title:l("select")||"Select & Move",children:u.jsx(h,{className:"h-4 w-4"})}),u.jsx($,{variant:"pen"===k?"default":"outline",size:"sm",onClick:()=>S("pen"),title:"Pen",children:u.jsx(m,{className:"h-4 w-4"})}),u.jsx($,{variant:"highlighter"===k?"default":"outline",size:"sm",onClick:()=>S("highlighter"),title:"Highlighter",children:u.jsx(x,{className:"h-4 w-4"})}),u.jsx($,{variant:"arrow"===k?"default":"outline",size:"sm",onClick:()=>S("arrow"),title:"Arrow",children:u.jsx(f,{className:"h-4 w-4"})}),u.jsx($,{variant:"text"===k?"default":"outline",size:"sm",onClick:()=>S("text"),title:"Text",children:u.jsx(p,{className:"h-4 w-4"})}),u.jsx($,{variant:"blur"===k?"default":"outline",size:"sm",onClick:()=>S("blur"),title:"Blur",children:u.jsx(g,{className:"h-4 w-4"})}),u.jsx($,{variant:"crop"===k?"default":"outline",size:"sm",onClick:()=>{S("crop"),se(null)},title:"Crop",children:u.jsx(v,{className:"h-4 w-4"})}),u.jsx($,{variant:"emoji"===k?"default":"outline",size:"sm",onClick:()=>{S("emoji"),K(!H)},title:"Emoji",children:u.jsx(y,{className:"h-4 w-4"})}),u.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),u.jsx($,{variant:"outline",size:"sm",onClick:()=>{V>=0&&q(V-1)},disabled:V<0,title:"Undo",children:u.jsx(w,{className:"h-4 w-4"})}),u.jsx($,{variant:"outline",size:"sm",onClick:()=>{V<B.length-1&&q(V+1)},disabled:V>=B.length-1,title:"Redo",children:u.jsx(j,{className:"h-4 w-4"})}),"crop"===k&&ae&&u.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[u.jsxs($,{size:"sm",onClick:()=>{if(!ae)return;const e=n.current,t=c.current;if(!e||!t)return;const r=document.createElement("canvas");r.width=ae.width,r.height=ae.height;const a=r.getContext("2d");if(!a)return;a.drawImage(e,ae.x,ae.y,ae.width,ae.height,0,0,ae.width,ae.height),a.drawImage(t,ae.x,ae.y,ae.width,ae.height,0,0,ae.width,ae.height);const s=r.toDataURL("image/png"),l=new Image;l.onload=()=>{C.current=l,se(null),X([]),q(-1),S("select"),e.width=l.width,e.height=l.height,t.width=l.width,t.height=l.height;const r=e.getContext("2d"),a=t.getContext("2d");null==r||r.clearRect(0,0,l.width,l.height),null==r||r.drawImage(l,0,0,l.width,l.height),null==a||a.clearRect(0,0,l.width,l.height),Y(!0),A.success("Image cropped")},l.src=s},className:"bg-teal-600 hover:bg-teal-700",children:[u.jsx(b,{className:"h-4 w-4 mr-1"}),s("applyCrop")]}),u.jsxs($,{size:"sm",variant:"outline",onClick:()=>se(null),children:[u.jsx(N,{className:"h-4 w-4 mr-1"}),s("clear")]})]})]}),("pen"===k||"highlighter"===k||"arrow"===k||"text"===k)&&u.jsx("div",{className:"flex items-center gap-2",children:le.map(e=>u.jsx("button",{onClick:()=>O(e),className:"w-8 h-8 rounded-full border-2 transition-transform hover:scale-110 "+(P===e?"border-blue-500 scale-110":"border-gray-300"),style:{backgroundColor:e},title:e},e))})]}),H&&u.jsx("div",{className:"px-4 py-3 border-b bg-gray-50",children:u.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:ne.map(e=>u.jsx("button",{onClick:()=>(e=>{const t=c.current;if(!t)return;const r={type:"emoji",tool:"emoji",color:"",emoji:e,x:t.width/2,y:t.height/2,fontSize:48},a=B.slice(0,V+1);a.push(r),X(a),q(a.length-1),K(!1),S("select")})(e),className:"text-3xl hover:scale-125 transition-transform p-2",children:e},e))})}),te&&u.jsxs("div",{className:"px-4 py-3 border-b bg-gray-50 flex items-center gap-2",style:{position:"absolute",top:"70px",left:"50%",transform:"translateX(-50%)",zIndex:50,width:"90%",maxWidth:"400px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",backgroundColor:"white",borderRadius:"0.5rem",padding:"0.75rem"},children:[u.jsx("input",{type:"text",value:G,onChange:e=>Q(e.target.value),onKeyDown:e=>"Enter"===e.key&&Ne(),placeholder:"Enter text...",className:"flex-1 px-3 py-2 border rounded",autoFocus:!0}),u.jsx($,{size:"sm",onClick:Ne,children:u.jsx(b,{className:"h-4 w-4"})}),u.jsx($,{size:"sm",variant:"outline",onClick:()=>{re(!1),Q(""),ee(null)},children:u.jsx(N,{className:"h-4 w-4"})})]}),u.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-100 p-4 overflow-auto relative",children:u.jsxs("div",{className:"relative",children:[u.jsx("canvas",{ref:n,className:"absolute top-0 left-0"}),u.jsx("canvas",{ref:c,className:"absolute top-0 left-0",style:{cursor:"select"===k?F:"crosshair"},onMouseDown:e=>{const t=pe(e);we(t)},onMouseMove:e=>{const t=pe(e);if("select"===k&&null===ce){const e=ye(t);R(e?"move":"default")}else"select"!==k&&R("crosshair");je(t)},onMouseUp:be,onMouseLeave:be,onTouchStart:e=>{e.preventDefault();const t=ge(e);we(t)},onTouchMove:e=>{e.preventDefault();const t=ge(e);je(t)},onTouchEnd:e=>{e.preventDefault(),be()}})]})}),u.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-white",children:[u.jsxs($,{variant:"outline",onClick:r,children:[u.jsx(N,{className:"h-4 w-4 mr-2"}),l("cancel")]}),u.jsxs($,{onClick:()=>{const e=n.current,t=c.current;if(!e||!t)return;const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const l=s.getContext("2d");l&&(l.drawImage(e,0,0),l.drawImage(t,0,0),s.toBlob(e=>{if(!e)return void A.error("Failed to process image");const t=new FileReader;t.onloadend=()=>{const e=t.result;a(e),r(),A.success("Image edited successfully")},t.readAsDataURL(e)},"image/png",1))},className:"bg-teal-600 hover:bg-teal-700",children:[u.jsx(b,{className:"h-4 w-4 mr-2"}),l("save")]})]})]})]})})}function oe(e,t,r,a){return d(this,null,function*(){let t;return t=yield function(e,t=.85,r,a){return d(this,null,function*(){return new Promise((s,l)=>{if(!e.type.startsWith("image/"))return void l(new Error("File is not an image"));if("image/webp"===e.type)return void s(e);const n=new FileReader;n.onload=n=>{var i;const o=new Image;o.onload=()=>{let n=o.width,i=o.height;{const e=n/i;n>r&&(n=r,i=n/e),i>a&&(i=a,n=i*e)}const c=document.createElement("canvas");c.width=n,c.height=i;const d=c.getContext("2d");d?(d.drawImage(o,0,0,n,i),c.toBlob(t=>{if(!t)return void l(new Error("Failed to convert image to WebP"));const r=e.name.replace(/\.[^/.]+$/,"")+".webp",a=new File([t],r,{type:"image/webp",lastModified:Date.now()});s(a)},"image/webp",t)):l(new Error("Failed to get canvas context"))},o.onerror=()=>{l(new Error("Failed to load image"))},(null==(i=n.target)?void 0:i.result)?o.src=n.target.result:l(new Error("Failed to read file"))},n.onerror=()=>{l(new Error("Failed to read file"))},n.readAsDataURL(e)})})}(e,.9,r,a),t})}function ce({type:e,value:t,onChange:r,className:a=""}){const{t:s}=E(),l=_.useRef(null),[n,i]=_.useState(0),[o,c]=_.useState(!1),[h,m]=_.useState(!1),[x,f]=_.useState(null),p=t=>d(null,null,function*(){if((t=>{const r="image"===e?20971520:104857600;return t.size>r?(A.error(`File size too large. Maximum size is ${r/1048576}MB`),!1):"image"!==e||t.type.startsWith("image/")?!("video"===e&&!t.type.startsWith("video/")&&(A.error("Please upload a video file"),1)):(A.error("Please upload an image file"),!1)})(t)){c(!0),i(0);try{let s=t;if("image"===e&&t.type.startsWith("image/")&&"image/webp"!==t.type)try{s=yield oe(t,0,1920,1920)}catch(a){}const l=setInterval(()=>{i(e=>e>=90?(clearInterval(l),90):e+10)},500),n=yield D(s,e);clearInterval(l),i(100),r(n),A.success(`${e} uploaded successfully`),c(!1)}catch(a){A.error(`Upload failed: ${a.message||"Unknown error"}`),c(!1),r("")}}}),g=e=>{if(!e||""===e.trim())return!1;try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}},v=()=>{};return u.jsxs("div",{className:`space-y-2 ${a}`,children:[u.jsx("input",{ref:l,type:"file",accept:"image"===e?"image/*":"video/*",onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&p(r),l.current&&(l.current.value="")},className:"hidden"}),t&&g(t)?u.jsx(O,{className:"relative overflow-hidden",children:u.jsxs(T,{className:"p-2",children:[u.jsxs("div",{className:"relative w-full overflow-hidden rounded-md",children:["image"===e?u.jsx("img",{src:t,alt:"Advertisement image",className:"w-full h-auto object-cover",loading:"lazy",onError:v}):u.jsx("video",{src:t,controls:!0,className:"h-full w-full",onError:v}),u.jsx($,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2 h-8 w-8 p-0",onClick:()=>d(null,null,function*(){if(t&&g(t))try{yield L(t,e),r(""),A.success("File removed successfully")}catch(a){r("")}else r("")}),children:u.jsx(N,{className:"h-4 w-4"})})]}),u.jsx("div",{className:"mt-2 flex gap-2",children:"image"===e&&u.jsx($,{type:"button",variant:"outline",size:"sm",className:"w-full",onClick:()=>m(!0),disabled:o,children:u.jsx(C,{className:"h-4 w-4"})})})]})}):u.jsx($,{type:"button",variant:"outline",className:"h-24 w-full border-dashed",onClick:()=>{var e;null==(e=l.current)||e.click()},disabled:o,children:u.jsxs("div",{className:"flex flex-col items-center justify-center",children:["image"===e?u.jsx(k,{className:"text-muted-foreground mb-1 h-6 w-6"}):u.jsx(S,{className:"text-muted-foreground mb-1 h-6 w-6"}),u.jsx("span",{className:"text-xs font-medium",children:s(o?"Admin.mediaUpload.uploading":"image"===e?"Admin.mediaUpload.clickToUploadImage":"Admin.mediaUpload.clickToUploadVideo")}),u.jsx("span",{className:"text-muted-foreground mt-0.5 text-[10px]",children:s("image"===e?"Admin.mediaUpload.fileFormats.image":"Admin.mediaUpload.fileFormats.video")})]})}),o&&u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(F,{className:"h-4 w-4 animate-pulse"}),u.jsxs("span",{className:"text-sm",children:[s("Admin.mediaUpload.uploading")," ",e,"..."]})]}),u.jsx(se,{value:n,className:"h-2"})]}),"image"===e&&t&&g(t)&&u.jsx(ie,{imageUrl:t,isOpen:h,onClose:()=>{m(!1),f(null)},onSave:e=>d(null,null,function*(){try{const t=yield fetch(e),a=yield t.blob(),s=new File([a],"edited-image.png",{type:"image/png"});r(""),yield p(s),f(null),m(!1)}catch(t){A.error("Failed to save edited image")}})})]})}export{ce as M};
